"use strict";var ke=Object.defineProperty;var i=(t,c)=>ke(t,"name",{value:c,configurable:!0});var q=(t,c)=>()=>(c||t((c={exports:{}}).exports,c),c.exports);var pe=q((ft,de)=>{"use strict";de.exports={number:"NUMERIC",string:"CHAR",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BIT",document:"NVARCHAR",array:"NVARCHAR",objectId:"VARCHAR(24)",jsonObject:"NVARCHAR",default:"CHAR"}});var ce=q((gt,Te)=>{"use strict";Te.exports={TINYINT:{capacity:1},SMALLINT:{capacity:2},INT:{capacity:4},BIGINT:{capacity:8},FLOAT:{capacity:8,mode:"floating"},REAL:{capacity:4,mode:"floating"},DECIMAL:{capacity:16,mode:"decimal"},NUMERIC:{capacity:12,mode:"decimal"},MONEY:{capacity:8,mode:"decimal"},SMALLMONEY:{capacity:4,mode:"decimal"},CHAR:{size:1},VARCHAR:{mode:"varying"},NCHAR:{size:1,encoding:"utf-8"},NVARCHAR:{encoding:"utf-8"},TEXT:{mode:"text"},NTEXT:{mode:"text",encoding:"utf-8"},DATE:{format:"YYYY-MM-DD"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss"},DATETIME2:{format:"YYYY-MM-DD hh:mm:ss.nnn"},DATETIMEOFFSET:{format:"YYYY-MM-DD hh:mm:ss.nnnZ"},SMALLDATETIME:{format:"YYYY-MM-DD hh:mm:ss"},TIME:{format:"hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},BINARY:{size:8e3,mode:"binary"},VARBINARY:{size:2147483649,mode:"binary"},IMAGE:{mode:"binary"},BIT:{mode:"boolean"},HIERARCHYID:{capacity:5,mode:"uuid"},UNIQUEIDENTIFIER:{mode:"uuid"},SQL_VARIANT:{mode:"variant"},XML:{mode:"xml"},GEOMETRY:{format:"euclidian",mode:"geospatial"},GEOGRAPHY:{format:"ellipsoidal",mode:"geospatial"},ROWVERSION:{mode:"version"},TABLE:{mode:"table"}}});var ne=q((Ct,ye)=>{"use strict";ye.exports={createDatabase:"CREATE DATABASE [${name}]${terminator}\nUSE [${name}]${terminator}",createSchema:"CREATE SCHEMA [${name}]${terminator}",createTable:"CREATE${external} TABLE ${name} (\n	${column_definitions}${temporalTableTime}${keyConstraints}${checkConstraints}${foreignKeyConstraints}${memoryOptimizedIndexes}\n)${options}${terminator}\n",columnDefinition:"[${name}] ${type}${primary_key}${temporalTableTime}${sparse}${maskedWithFunction}${identity}${default}${collation}${not_null}${encryptedWith}",partition:"PARTITION ([${name}] RANGE ${range} FOR VALUES (${values}))",index:"CREATE${clustered} INDEX ${name}\n	ON ${table} ( ${keys} )${index_options}${terminator}\n",columnStoreIndex:"CREATE CLUSTERED COLUMNSTORE INDEX ${name}\n	ON ${table}${order}${index_options}${terminator}\n",fullTextIndex:"CREATE FULLTEXT INDEX ON ${table} (\n	${keys}\n)\nKEY INDEX ${indexName}\n${catalog}${options}${terminator}\n",spatialIndex:"CREATE SPATIAL INDEX ${name} ON ${table} (${column})${using}\n${options}${terminator}\n",checkConstraint:"CONSTRAINT [${name}] CHECK${notForReplication} (${expression})",createForeignKeyConstraint:"CONSTRAINT [${name}] FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})",createView:"CREATE${materialized} VIEW ${name}\n${view_attribute}AS ${select_statement}${check_option}${options}${terminator}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createUdtFromBaseType:"CREATE TYPE ${name} FROM ${base_type}${not_null}${terminator}\n",createKeyConstraint:"${constraintName}${keyType}${clustered}${columns}${options}${partition}",createDefaultConstraint:"ALTER TABLE ${tableName} ADD CONSTRAINT [${constraintName}] DEFAULT (${default}) FOR [${columnName}]${terminator}\n",ifNotExistSchema:"IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = N'${schemaName}')\nbegin\n	EXEC('${statement}')\nend${terminator}",ifNotExistDatabase:"IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = N'[${databaseName}]')\nbegin\n${statement}\nend${terminator}",ifNotExistTable:`IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'\${tableName}') AND type in (N'U'))
begin
\${statement}
end\${terminator}
`,ifNotExistView:`IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'\${viewName}') AND type in (N'V'))
begin
EXEC('
\${statement}')
end\${terminator}
`,dropSchema:"DROP SCHEMA [${name}]${terminator}",dropTable:"DROP TABLE ${name}${terminator}",dropIndex:"DROP INDEX [${name}] ON ${object}${terminator}",alterTableOptions:"ALTER TABLE ${tableName} ${options}${terminator}",alterTableAddConstraint:"ALTER TABLE ${tableName} ADD ${constraint}${terminator}",alterTable:"ALTER TABLE ${tableName} ${command}${terminator}",dropColumn:"DROP COLUMN [${name}]",addColumn:"ADD ${script}",alterColumn:"ALTER COLUMN [${name}] ${type}${collation}${not_null}",renameColumn:"EXEC sp_rename '${fullTableName}.${oldColumnName}', '${newColumnName}', 'COLUMN';${terminator}",dropView:"DROP VIEW IF EXISTS ${name}${terminator}",alterView:"ALTER VIEW ${name}\nAS ${select_statement}${terminator}"}});var te=q(($t,Ne)=>{"use strict";var Ee="-- ",qe=/(\n\/\*\n[\s\S]*?\n\s\*\/\n)|((\n\/\*\n[\s\S]*?\n\s\*\/)$)/gi,Ye=i((t,c,y)=>c?.hasOwnProperty("isActivated")&&!c.isActivated?y?"/* "+t+" */":t.includes(`
`)?`/*
`+t+` */
`:Ee+t:t,"commentIfDeactivated"),He=i((t="")=>t.startsWith(Ee),"queryIsDeactivated"),Ve=i(t=>t.replace(qe,""),"filterDeactivatedQuery");Ne.exports={commentIfDeactivated:Ye,queryIsDeactivated:He,filterDeactivatedQuery:Ve}});var Ae=q((Rt,Ie)=>{"use strict";var Ge=i(({index:t,numberOfStatements:c,lastIndexOfActivatedStatement:y,delimiter:_})=>{let E=t===c-1,K=t===y;return E?"":K?" --"+_:_},"getDelimiter"),Be=i(({statements:t=[],delimiter:c=",",indent:y=`
`})=>{let _=t.findLastIndex(K=>!K.startsWith("--")),E=t.length;return t.map((K,Y)=>{let v=Ge({index:Y,numberOfStatements:E,lastIndexOfActivatedStatement:_,delimiter:c});return K+v}).join(y)},"joinActivatedAndDeactivatedStatements");Ie.exports={joinActivatedAndDeactivatedStatements:Be}});var ge=q((vt,fe)=>{"use strict";var De=`
GO`,We="useGoStatement",Xe=i(t=>(t?.additionalOptions??[]).find(y=>y.id===We)?.value,"needToUseGoStatement"),ze=i(t=>Xe(t)?De:";","getTerminator");fe.exports={getTerminator:ze}});var $e=q((ht,Ce)=>{"use strict";var je=require("lodash");Ce.exports=t=>{let{assignTemplates:c}=t.require("@hackolade/ddl-fe-utils"),{tab:y}=t.require("@hackolade/ddl-fe-utils").general;return{wrapIfNotExistSchema:i(({templates:v,schemaStatement:g,schemaName:$,terminator:O})=>c(v.ifNotExistSchema,{statement:je.trim(y(g)),schemaName:$,terminator:O}),"wrapIfNotExistSchema"),wrapIfNotExistDatabase:i(({templates:v,databaseStatement:g,databaseName:$,terminator:O})=>c(v.ifNotExistDatabase,{statement:y(g),databaseName:$,terminator:O}),"wrapIfNotExistDatabase"),wrapIfNotExistTable:i(({templates:v,tableStatement:g,tableName:$,terminator:O})=>c(v.ifNotExistTable,{statement:y(g),tableName:$,terminator:O}),"wrapIfNotExistTable"),wrapIfNotExistView:i(({templates:v,viewStatement:g,viewName:$,terminator:O})=>c(v.ifNotExistView,{statement:y(g),viewName:$,terminator:O}),"wrapIfNotExistView")}}});var le=q((_t,Re)=>{"use strict";var J=require("lodash"),Qe=i((t,c)=>`${t}(${c})`,"addLength"),Ze=i(t=>`${t}(MAX)`,"addMaxLength"),Je=i((t,c,y)=>J.isNumber(y)?`${t}(${c},${y})`:`${t}(${c})`,"addScalePrecision"),et=i((t,c)=>`${t}(${c})`,"addPrecision"),tt=i((t,c,y)=>y?c?`${t}(${c} ${y})`:`${t}(${y})`:t,"addXmlProperties"),rt=i(t=>["CHAR","NCHAR","VARCHAR","NVARCHAR","BINARY","VARBINARY"].includes(t),"canHaveLength"),nt=i(t=>["VARCHAR","NVARCHAR","VARBINARY"].includes(t),"canHaveMax"),Oe=i(t=>["DECIMAL","NUMERIC","DATETIME2","DATETIMEOFFSET","TIME"].includes(t),"canHavePrecision"),it=i(t=>["DECIMAL","NUMERIC"].includes(t),"canHaveScale"),st=i((t,c)=>nt(t)&&c.hasMaxLength?Ze(t):rt(t)&&J.isNumber(c.length)?Qe(t,c.length):Oe(t)&&it(t)&&J.isNumber(c.precision)?Je(t,c.precision,c.scale):Oe(t)&&J.isNumber(c.precision)?et(t,c.precision):t==="XML"?tt(t,c.xmlConstraint,c.xmlSchemaCollection):t,"decorateType"),at=i(t=>["CHAR","VARCHAR","NCHAR","NVARCHAR","TEXT","NTEXT"].includes(J.toUpper(t)),"isString"),ot=i(t=>J.trim(t).replace(/(\')+/g,"'$1"),"escapeQuotes"),ct=i((t,c)=>at(t)&&c!=="NULL"?`'${ot(c)}'`:t==="XML"?`CAST(N'${c}' AS xml)`:c,"decorateDefault"),lt=i(t=>!t.seed||!t.increment?"":` IDENTITY(${t.seed}, ${t.increment})`,"getIdentity"),mt=i((t,c)=>!c.primaryKey&&!c.unique?"":c.clustered?t+" CLUSTERED":t+" NONCLUSTERED","addClustered"),ut=i(t=>` ENCRYPTED WITH (
		COLUMN_ENCRYPTION_KEY=`+t.key+`,
		ENCRYPTION_TYPE=`+t.type+`,
		ALGORITHM='`+t.algorithm+`'
	)`,"getEncryptedWith"),dt=i(t=>["tinyint","smallint","int","bigint"].includes(t),"canHaveIdentity");Re.exports={decorateType:st,decorateDefault:ct,getIdentity:lt,getEncryptedWith:ut,addClustered:mt,canHaveIdentity:dt}});var ie=q((Mt,ve)=>{"use strict";var S=require("lodash"),{commentIfDeactivated:be}=te(),pt=ce(),Tt=ne();ve.exports=t=>{let c=t.require("@hackolade/ddl-fe-utils").general.hasType,{decorateDefault:y}=le(),{checkAllKeysDeactivated:_}=t.require("@hackolade/ddl-fe-utils").general,{assignTemplates:E}=t.require("@hackolade/ddl-fe-utils"),K="clustered columnstore index order",Y="clustered index",v="hash",g=i(s=>["VARCHAR","CHAR","NCHAR","NVARCHAR"].includes(S.toUpper(s)),"isString"),$=i((s,l)=>l?`[${l}].[${s}]`:`[${s}]`,"getTableName"),O=i((s,l,p)=>S.isUndefined(s)||!S.isUndefined(l)?"":` DEFAULT ${y(p,s)}`,"getDefaultValue"),R=i(s=>s?s.alias?`[${s.name}] as [${s.alias}]`:`[${s.name}]`:"","getKeyWithAlias");return{filterColumnStoreProperties:i(s=>{if(s.type!=="columnstore")return s;let l=["allowRowLocks","allowPageLocks","padIndex","fillFactor","ignoreDuplicateKey"];return Object.keys(s).reduce((p,u)=>l.includes(u)?p:Object.assign({},p,{[u]:s[u]}),{})},"filterColumnStoreProperties"),getKeyWithAlias:R,getTableName:$,getTableOptions:i(s=>{if(!s)return"";let l=S.get(s,"partition",{}),p=[];if(s.indexing){let u=S.toUpper(s.indexing);s.indexing===K&&(u+="(",u+=s.indexingOrderColumn.map(({name:I})=>`[${I}]`).join(", "),u+=")"),s.indexing===Y&&(u+="(",u+=s.clusteringColumn.map(({name:I})=>`[${I}]`).join(", "),u+=")"),p.push(u)}if(l.name){let u=S.toUpper(l.rangeForValues||"LEFT"),I=l.boundaryValue||"",se=E(Tt.partition,{name:l.name,range:u,values:I});p.push(be(se,{isActivated:l.isActivated}))}if(s.distribution){let u=`DISTRIBUTION = ${S.toUpper(s.distribution)}`;s.distribution===v&&(u+="(",u+=s.hashColumn.map(({name:I})=>`[${I}]`).join(", "),u+=")"),p.push(u)}return s.forAppend&&p.push("FOR_APPEND"),S.isEmpty(p)?"":`WITH (
	${p.join(`,
	`)}
)`},"getTableOptions"),hasType:i(s=>c(pt,s),"hasType"),getViewData:i((s,l)=>Array.isArray(s)?s.reduce((p,u)=>{if(!u.tableName)return p.columns.push(R(u)),p;let I=$(u.tableName,u.schemaName);return u.dbName&&u.dbName!==l.databaseName&&(I=`[${u.dbName}].`+I),p.tables.includes(I)||p.tables.push(I),p.columns.push({statement:`${I}.${R(u)}`,isActivated:u.isActivated}),p},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),getDefaultConstraints:i(s=>Array.isArray(s)?s.filter(l=>S.get(l,"defaultConstraint.name")&&!S.isNil(S.get(l,"defaultConstraint.value"))).map(l=>({columnName:l.name,constraintName:l.defaultConstraint.name,value:y(l.type,l.defaultConstraint.value)})):[],"getDefaultConstraints"),foreignKeysToString:i(s=>{if(Array.isArray(s)){let l=s.filter(I=>S.get(I,"isActivated",!0)).map(I=>`[${I.name.trim()}]`),p=s.filter(I=>!S.get(I,"isActivated",!0)).map(I=>`[${I.name.trim()}]`),u=p.length?be(p,{isActivated:!1},!0):"";return l.join(", ")+u}return s},"foreignKeysToString"),trimBraces:i(s=>/^\(([\s\S]+?)\)$/i.test(S.trim(s))?S.trim(s).replace(/^\(([\s\S]+?)\)$/i,"$1"):s,"trimBraces"),checkIndexActivated:i(s=>{if(s.isActivated===!1)return!1;let l=_(S.get(s,"keys",[])),p=_(S.get(s,"include",[])),u=!S.get(s,"column.isActivated",!0);return!l&&!p&&!u},"checkIndexActivated"),foreignActiveKeysToString:i(s=>s.map(l=>l.name.trim()).join(", "),"foreignActiveKeysToString"),getDefaultValue:O,getTempTableTime:i((s,l,p)=>s?` GENERATED ALWAYS AS ROW START${p?" HIDDEN":""}`:l?` GENERATED ALWAYS AS ROW END${p?" HIDDEN":""}`:"","getTempTableTime"),getCollation:i((s,l)=>!g(s)||S.isEmpty(l)?"":" COLLATE "+Object.entries(l).map(([p,u])=>u).join("_"),"getCollation"),setPersistenceSpecificName:i((s,l)=>s!=="temporary"||S.first(l)==="#"?l:`#${l}`,"setPersistenceSpecificName")}}});var Le=q((xt,he)=>{"use strict";var j=require("lodash"),Se=ne(),{commentIfDeactivated:me}=te();he.exports=t=>{let{filterColumnStoreProperties:c,getTableName:y}=ie()(t),{assignTemplates:_}=t.require("@hackolade/ddl-fe-utils"),{divideIntoActivatedAndDeactivated:E,checkAllKeysDeactivated:K}=t.require("@hackolade/ddl-fe-utils").general,Y=i(e=>{let o=[];return e.padIndex&&o.push("PAD_INDEX = ON"),e.fillFactor&&o.push("FILLFACTOR = "+e.fillFactor),e.ignoreDuplicateKey&&o.push("IGNORE_DUP_KEY = ON"),e.statisticsNoRecompute&&o.push("STATISTICS_NORECOMPUTE = ON"),e.statisticsIncremental&&o.push("STATISTICS_INCREMENTAL = ON"),e.allowRowLocks===!1&&o.push("ALLOW_ROW_LOCKS = OFF"),e.allowPageLocks===!1&&o.push("ALLOW_PAGE_LOCKS = OFF"),e.optimizeForSequentialKey&&o.push("OPTIMIZE_FOR_SEQUENTIAL_KEY = ON"),e.type==="columnstore"&&e.compressionDelay&&o.push("COMPRESSION_DELAY = "+e.compressionDelay),e.dataCompression&&e.dataCompression!=="NONE"&&o.push("DATA_COMPRESSION = "+e.dataCompression),o},"getRelationOptionsIndex"),v=i(e=>{let o=[];return e.dropExisting&&o.unshift("DROP_EXISTING = ON"),o},"getIndexOptions"),g=i(e=>e.length?`
	WITH (
		`+e.join(`,
		`)+`
	)`:"","createIndexOptions"),$=i((e,o,m)=>{let s=E(e,o),l=s.deactivatedItems.join(", "),p=l?me(l,{isActivated:!1},!0):"",u=s.activatedItems.join(", ");return m?u+p:u+(l?", ":"")+l},"getIndexKeys"),O=i((e,o,m,s=!0)=>{if(j.isEmpty(m.keys)||!m.name)return"";let l=v(m),p=$(m.keys,I=>`[${I.name}]`+(j.toLower(I.type)==="descending"?" DESC":""),s),u=m.clustered?" CLUSTERED":" NONCLUSTERED";return _(Se.index,{name:m.name,clustered:u,table:y(o,m.schemaName),keys:p,index_options:g(l),terminator:e})},"createIndex"),R=i((e,o,m,s=!0)=>{if(!m.name)return"";let l=v(m),p=$(m.orderKeys||[],u=>`[${u.name}]`,s);return _(Se.columnStoreIndex,{name:m.name,table:y(o,m.schemaName),order:p?`
	ORDER (${p})`:"",index_options:g(l),terminator:e})},"createColumnStoreIndex"),H=i((e,o,m,s)=>m.type==="columnstore"?R(e,o,m,s):O(e,o,m,s),"createTableIndex"),D=i(e=>{let o="CLUSTERED COLUMNSTORE";return e.compressionDelay&&(o+=` WITH (COMPRESSION_DELAY = ${e.compressionDelay})`),e.fileGroupName&&(o+=` ON ${e.fileGroupName}`),o},"createMemoryOptimizedClusteredIndex"),W=i(e=>o=>{let m=`INDEX ${o.name}`;if(o.clustered)return{statement:m+" "+D(o),isActivated:!0};let s=K(o.keys);if(m+=" NONCLUSTERED",o.unique&&(m+=" UNIQUE"),o.hash){let l=E(o.keys,I=>`[${I.name}]`),p=l.activatedItems.join(", "),u=l.deactivatedItems.length?me(l.deactivatedItems.join(", "),{isActivated:!e},!0):"";m+=` HASH (${p}${p.length&&u.length&&!u.startsWith("/*")?", ":""}${u})`,o.bucketCount&&(m+=` WITH (BUCKET_COUNT=${o.bucketCount})`)}else{let l=E(o.keys,I=>`[${I.name}]${j.toLower(I.type)==="descending"?" DESC":""}`),p=l.activatedItems.join(", "),u=l.deactivatedItems.length?me(l.deactivatedItems.join(", "),{isActivated:!e},!0):"";m+=` (${p}${p.length&&u.length&&!u.startsWith("/*")?", ":""}${u})`,o.fileGroupName&&(m+=` ON ${o.fileGroupName}`)}return{statement:m,isActivated:!s}},"createMemoryOptimizedIndex"),w=i((e,o)=>{let m=i(s=>Array.isArray(s)?s:[],"toArray");return c({name:e.indxName,isActivated:e.isActivated,type:j.toLower(e.indxType),clustered:e.clusteredIndx,keys:m(e.indxKey),orderKeys:m(e.orderKey),dropExisting:e.DROP_EXISTING,schemaName:o.schemaName})},"hydrateIndex"),X=i(e=>o=>{let m=w(o,e);return{name:m.name,isActivated:m.isActivated,clustered:m.clustered,hash:o.indxHash,unique:m.unique,keys:m.keys,bucketCount:isNaN(o.indxBucketCount)?-1:o.indxBucketCount,fileGroupName:o.indxFileGroupName,compressionDelay:m.compressionDelay}},"hydrateMemoryOptimizedIndex"),a=i((e,o)=>{let m=w(e,o);return{type:"fulltext",isActivated:e.isActivated,keys:Array.isArray(e.indxFullTextKeysProperties)?m.keys.map((s,l)=>{let p=e.indxFullTextKeysProperties[l];return p?{...s,columnType:p.columnType,languageTerm:p.languageTerm,statisticalSemantics:p.statisticalSemantics}:s}):m.keys,keyIndex:e.indxFullTextKeyIndex,catalogName:e.indxFullTextCatalogName,fileGroup:e.indxFullTextFileGroup,changeTracking:e.indxFullTextChangeTracking==="OFF"&&e.indxFullTextNoPopulation?"OFF, NO POPULATION":e.indxFullTextChangeTracking,stopList:e.indxFullTextStopList==="Stoplist name"?e.indxFullTextStopListName:e.indxFullTextStopList,searchPropertyList:e.indxFullTextSearchPropertyList,schemaName:o.schemaName}},"hydrateFullTextIndex"),N=i((e,o)=>{let m=w(e,o);return{...j.pick(m,["name","type","padIndex","fillFactor","ignoreDuplicateKey","statisticsNoRecompute","allowRowLocks","allowPageLocks","dataCompression","isActivated"]),column:m.keys[0],using:e.indxUsing,boundingBox:!j.isEmpty(e.indxBoundingBox)&&["GEOMETRY_AUTO_GRID","GEOMETRY_GRID"].includes(e.indxUsing)?e.indxBoundingBox:{},grids:!j.isEmpty(e.indxGrids)&&["GEOMETRY_GRID","GEOGRAPHY_GRID"].includes(e.indxUsing)?e.indxGrids:[],cellsPerObject:e.CELLS_PER_OBJECT,sortInTempdb:e.SORT_IN_TEMPDB,dropExisting:e.DROP_EXISTING,maxdop:e.MAXDOP,schemaName:o.schemaName}},"hydrateSpatialIndex");return{getRelationOptionsIndex:Y,createIndex:O,hydrateIndex:w,hydrateMemoryOptimizedIndex:X,createMemoryOptimizedIndex:W,hydrateTableIndex:i((e,o)=>e.indxType==="Spatial"?N(e,o):e.indxType==="FullText"?a(e,o):w(e,o),"hydrateTableIndex"),createTableIndex:H,getMemoryOptimizedIndexes:i((e,o)=>{let m=e.find(s=>j.has(s,"Indxs"));return m?m.Indxs.map(X(o)):[]},"getMemoryOptimizedIndexes")}}});var Me=q((wt,Ke)=>{"use strict";var Ut=require("lodash"),{commentIfDeactivated:_e}=te();Ke.exports=t=>{let{assignTemplates:c}=t.require("@hackolade/ddl-fe-utils"),{checkAllKeysDeactivated:y,divideIntoActivatedAndDeactivated:_}=t.require("@hackolade/ddl-fe-utils").general,{trimBraces:E}=ie()(t);return{createDefaultConstraint:i((g,$)=>(O,R)=>c(g.createDefaultConstraint,{tableName:R,constraintName:O.constraintName,columnName:O.columnName,default:E(O.value),terminator:$}),"createDefaultConstraint"),createKeyConstraint:i((g,$,O)=>R=>{let H=R.partition?` ON [${R.partition}]`:"",D=i(({name:N,order:h})=>`[${N}] ${h}`.trim(),"columnMapToString"),W=y(R.columns),w=_(R.columns,D),X=w.deactivatedItems.length?_e(w.deactivatedItems.join(", "),{isActivated:!1},!0):"",a=!W&&O?" ("+w.activatedItems.join(", ")+X+")":" ("+R.columns.map(D).join(", ")+")";return{statement:c(g.createKeyConstraint,{constraintName:R.name?`CONSTRAINT [${R.name}] `:"",keyType:R.keyType,clustered:" NONCLUSTERED",columns:a,options:" NOT ENFORCED",partition:H,terminator:$}),isActivated:!W}},"createKeyConstraint"),generateConstraintsString:i((g,$)=>{let O=g.activatedItems.length?`,
	`+g.activatedItems.join(`,
	`):"",R=g.deactivatedItems.length?`
	`+_e(g.deactivatedItems.join(`,
	`),{isActivated:!$},!0):"";return O+R},"generateConstraintsString")}}});var xe=q((qt,Fe)=>{"use strict";var G=require("lodash");Fe.exports=t=>{let{clean:c}=t.require("@hackolade/ddl-fe-utils").general,y=i((a,N)=>Object.entries(a.properties).map(N),"mapProperties"),_=i(a=>a.compositeUniqueKey?!1:a.unique?!!G.isEmpty(a.uniqueKeyOptions):!1,"isInlineUnique"),E=i(a=>a.compositeUniqueKey||a.compositePrimaryKey?!1:a.primaryKey?!!G.isEmpty(a.primaryKeyOptions):!1,"isInlinePrimaryKey"),K=i(a=>a.compositeUniqueKey?!1:a.unique?!G.isEmpty(a.uniqueKeyOptions):!1,"isUnique"),Y=i(a=>a.compositeUniqueKey||a.compositePrimaryKey?!1:a.primaryKey?!G.isEmpty(a.primaryKeyOptions):!1,"isPrimaryKey"),v=i(a=>G.toLower(a)==="asc"?"ASC":G.toLower(a)==="desc"?"DESC":"","getOrder"),g=i((a,N,h)=>c({keyType:"UNIQUE",name:a.constraintName,columns:[{name:N,order:v(a.order),isActivated:h}],partition:a.partitionName,clustered:a.clustered,indexOption:c({statisticsNoRecompute:a.staticticsNorecompute,statisticsIncremental:a.statisticsIncremental,ignoreDuplicateKey:a.ignoreDuplicate,fillFactor:a.fillFactor,allowRowLocks:!!a.allowRowLocks,allowPageLocks:!!a.allowPageLocks,optimizeForSequentialKey:a.isOptimizedForSequentialKey,padIndex:a.isPadded,dataCompression:a.dataCompression})}),"hydrateUniqueOptions"),$=i((a,N,h)=>c({keyType:"PRIMARY KEY",name:a.constraintName,columns:[{name:N,order:v(a.order),isActivated:h}],partition:a.partitionName,clustered:a.clustered,indexOption:c({statisticsNoRecompute:a.staticticsNorecompute,statisticsIncremental:a.statisticsIncremental,ignoreDuplicateKey:a.ignoreDuplicate,fillFactor:a.fillFactor,allowRowLocks:!!a.allowRowLocks,allowPageLocks:!!a.allowPageLocks,optimizeForSequentialKey:a.isOptimizedForSequentialKey,padIndex:a.isPadded,dataCompression:a.dataCompression})}),"hydratePrimaryKeyOptions"),O=i((a,N)=>Object.keys(N).find(h=>N[h].GUID===a),"findName"),R=i((a,N)=>G.get(Object.values(N).find(h=>h.GUID===a),"isActivated",!0),"checkIfActivated"),H=i((a,N)=>a.map(h=>({name:O(h.keyId,N.properties),order:h.type==="descending"?"DESC":"ASC",isActivated:R(h.keyId,N.properties)})),"getKeys"),D=i(a=>Array.isArray(a.primaryKey)?a.primaryKey.filter(N=>!G.isEmpty(N.compositePrimaryKey)).map(N=>({...$(N),columns:H(N.compositePrimaryKey,a)})):[],"getCompositePrimaryKeys"),W=i(a=>Array.isArray(a.uniqueKey)?a.uniqueKey.filter(N=>!G.isEmpty(N.compositeUniqueKey)).map(N=>({...g(N),columns:H(N.compositeUniqueKey,a)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i(({jsonSchema:a})=>{if(!a.properties)return[];let N=G.flatten(y(a,([z,e])=>K(e)?e.uniqueKeyOptions.map(o=>g(o,z,e.isActivated)):[])).filter(Boolean),h=y(a,([z,e])=>{if(Y(e))return $(e.primaryKeyOptions,z,e.isActivated)}).filter(Boolean);return[...D(a),...h,...W(a),...N]},"getTableKeyConstraints"),isInlineUnique:_,isInlinePrimaryKey:E,getTablePartitionKey:i(a=>{let N=H(a.partition||[],a);return{...G.get(N,"[0]",{}),boundaryValue:a.boundaryValue,rangeForValues:a.rangeForValues}},"getTablePartitionKey")}}});var d=require("lodash"),yt=pe(),Et=ce(),f=ne(),{commentIfDeactivated:ee}=te(),{joinActivatedAndDeactivatedStatements:Nt}=Ae(),It=i((t,c,y)=>{let{getTerminator:_}=ge(),{assignTemplates:E}=y.require("@hackolade/ddl-fe-utils"),{divideIntoActivatedAndDeactivated:K,clean:Y,tab:v}=y.require("@hackolade/ddl-fe-utils").general,{wrapIfNotExistSchema:g,wrapIfNotExistDatabase:$,wrapIfNotExistTable:O,wrapIfNotExistView:R}=$e()(y),{decorateType:H,getIdentity:D,getEncryptedWith:W,decorateDefault:w,canHaveIdentity:X}=le(),{getMemoryOptimizedIndexes:a,createMemoryOptimizedIndex:N,hydrateTableIndex:h,createTableIndex:z}=Le()(y),{getTableName:e,getTableOptions:o,hasType:m,getDefaultConstraints:s,checkIndexActivated:l,getViewData:p,getCollation:u,setPersistenceSpecificName:I}=ie()(y),{createKeyConstraint:se,createDefaultConstraint:Pe,generateConstraintsString:Ue}=Me()(y),re=xe()(y),b=_(c);return{createSchema({schemaName:n,databaseName:r,ifNotExist:T}){let C=T?";":b,A=E(f.createSchema,{name:n,terminator:C});if(!r)return T?g({templates:f,schemaStatement:A,schemaName:n,terminator:b}):A;let L=$({templates:f,databaseName:r,terminator:b,databaseStatement:E(f.createDatabase,{name:r,terminator:C})});return T?L+`

`+g({templates:f,schemaStatement:A,schemaName:n,terminator:b}):L+`

`+A},createTable({name:n,columns:r,checkConstraints:T,keyConstraints:C,options:A,schemaData:L,defaultConstraints:M,memoryOptimizedIndexes:B,persistence:F,ifNotExist:x},P){let V=x?";":b,U=e(I(F,n),L.schemaName),Q=K(C.map(se(f,V,P)),Z=>Z.statement),k=Ue(Q,P),ae=Nt({statements:r,indent:`
	`}),oe=E(f.createTable,{name:U,external:F==="external"?" EXTERNAL":"",column_definitions:ae,checkConstraints:T.length?`,
	`+T.join(`,
	`):"",foreignKeyConstraints:"",options:o(A),keyConstraints:k,memoryOptimizedIndexes:B.length?`,
	`+B.map(N(P)).map(Z=>ee(Z.statement,Z)).join(`,
	`):"",terminator:V}),we=M.map(Z=>Pe(f,V)(Z,U)).join(`
`),ue=[oe,we].filter(Boolean).join(`

`);return x?O({tableStatement:ue,templates:f,tableName:U,terminator:b}):ue},convertColumnDefinition(n){let r=m(n.type)?d.toUpper(n.type):e(n.type,n.schemaName),T=n.nullable?"":" NOT NULL",C=n.primaryKey?" PRIMARY KEY NONCLUSTERED NOT ENFORCED":"",A=d.isUndefined(n.default)?"":" DEFAULT "+w(r,n.default),L=n.sparse?" SPARSE":"",M=n.maskedWithFunction?` MASKED WITH (FUNCTION='${n.maskedWithFunction}')`:"",B=n.identity&&{identity:D(n.identity)},F=d.isEmpty(n.encryption)?"":W(n.encryption[0]),x=n.unique?" UNIQUE NOT ENFORCED":"";return ee(E(f.columnDefinition,{name:n.name,type:H(r,n),primary_key:C+x,not_null:T,default:A,collation:u(n.type,n.collation),sparse:L,maskedWithFunction:M,encryptedWith:F,terminator:b,...B}),n)},createIndex(n,r,T,C=!0){let A=l(r);return C?ee(z(b,n,r,A&&C),{isActivated:A}):z(b,n,r,A&&C)},createCheckConstraint(n){return E(f.checkConstraint,{name:n.name,notForReplication:n.enforceForReplication?"":" NOT FOR REPLICATION",expression:d.trim(n.expression).replace(/^\(([\s\S]*)\)$/,"$1"),terminator:b})},createForeignKeyConstraint(){return""},createForeignKey(){return""},createView({name:n,keys:r,selectStatement:T,options:C,materialized:A,schemaData:L,ifNotExist:M},B,F){let x=M?";":b,P=p(r,L);if((d.isEmpty(P.tables)||d.isEmpty(P.columns))&&!T)return"";let V=P.columns.map(k=>k.statement).join(",n		");if(F){let k=K(P.columns,oe=>oe.statement),ae=k.deactivatedItems.length?ee(k.deactivatedItems.join(`,
		`),{isActivated:!1},!0):"";V=k.activatedItems.join(`,
		`)+ae}let U=e(n,L.schemaName);if(!A){let k=E(f.createView,{name:U,select_statement:d.trim(T)?d.trim(v(T))+`
`:E(f.viewSelectStatement,{tableName:P.tables.join(", "),keys:V,terminator:x}),terminator:x});return M?R({templates:f,viewStatement:k,viewName:U,terminator:b}):k}let Q=E(f.createView,{name:U,materialized:" MATERIALIZED",options:o(C),select_statement:d.trim(T)?d.trim(v(T))+`
`:E(f.viewSelectStatement,{tableName:P.tables.join(", "),keys:V,terminator:x}),terminator:x});return M?R({templates:f,viewStatement:Q,viewName:U,terminator:b}):Q},createUdt(){return""},getDefaultType(n){return yt[n]},getTypesDescriptors(){return Et},hasType(n){return m(n)},hydrateColumn({columnDefinition:n,jsonSchema:r,schemaData:T,parentJsonSchema:C}){let A=[];Array.isArray(r.encryption)?A=r.encryption.map(({COLUMN_ENCRYPTION_KEY:x,ENCRYPTION_TYPE:P,ENCRYPTION_ALGORITHM:V})=>({key:x,type:P,algorithm:V})):d.isPlainObject(r.encryption)&&(A=[{key:r.encryption.COLUMN_ENCRYPTION_KEY,type:r.encryption.ENCRYPTION_TYPE,algorithm:r.encryption.ENCRYPTION_ALGORITHM}]);let L=r.GUID===d.get(C,"periodForSystemTime[0].startTime[0].keyId",""),M=r.GUID===d.get(C,"periodForSystemTime[0].endTime[0].keyId",""),B=d.get(C,"periodForSystemTime[0].startTime[0].type","")==="hidden",F=d.get(C,"periodForSystemTime[0].startTime[0].type","")==="hidden";return Object.assign({},n,{default:r.defaultConstraintName?"":n.default,defaultConstraint:{name:r.defaultConstraintName,value:n.default},primaryKey:re.isInlinePrimaryKey(r),xmlConstraint:String(r.XMLconstraint||""),xmlSchemaCollection:String(r.xml_schema_collection||""),sparse:!!r.sparse,maskedWithFunction:String(r.maskedWithFunction||""),schemaName:T.schemaName,unique:re.isInlineUnique(r),isTempTableStartTimeColumn:L,isTempTableEndTimeColumn:M,isHidden:L?B:F,encryption:A,hasMaxLength:n.hasMaxLength||r.type==="jsonObject",collation:r.collate?Y({locale:r.locale,caseSensitivity:r.caseSensitivity,accentSensitivity:r.accentSensitivity,kanaSensitivity:r.kanaSensitivity,widthSensitivity:r.widthSensitivity,variationSelectorSensitivity:r.variationSelectorSensitivity,binarySort:r.binarySort,utf8:r.utf8}):{},...X(r.mode)&&{identity:{seed:Number(d.get(r,"identity.identitySeed",0)),increment:Number(d.get(r,"identity.identityIncrement",0))}}})},hydrateIndex(n,r,T){if(!d.get(r,"[0].memory_optimized",!1))return h(n,T)},hydrateCheckConstraint(n){return{name:n.chkConstrName,expression:n.constrExpression,existingData:n.constrCheck,enforceForUpserts:n.constrEnforceUpserts,enforceForReplication:n.constrEnforceReplication}},hydrateSchema(n){return{schemaName:n.name,databaseName:n.databaseName,ifNotExist:n.ifNotExist}},hydrateTable({tableData:n,entityData:r,jsonSchema:T,idToNameHashTable:C}){let A=d.get(r,"[0].memory_optimized",!1),L=C[d.get(T,"periodForSystemTime[0].startTime[0].keyId","")],M=C[d.get(T,"periodForSystemTime[0].endTime[0].keyId","")];return Object.assign({},n,{foreignKeyConstraints:n.foreignKeyConstraints||[],keyConstraints:re.getTableKeyConstraints({jsonSchema:T}),defaultConstraints:s(n.columnDefinitions),ifNotExist:T.ifNotExist,persistence:d.get(r,"[0].persistence",""),options:{memory_optimized:A,durability:d.get(r,"[0].durability",""),systemVersioning:d.get(r,"[0].systemVersioning",!1),historyTable:d.get(r,"[0].historyTable",""),dataConsistencyCheck:d.get(r,"[0].dataConsistencyCheck",!1),temporal:d.get(r,"[0].temporal",!1),ledger:d.get(r,"[0].ledger",!1),ledger_view:d.get(r,"[0].ledger_view"),transaction_id_column_name:d.get(r,"[0].transaction_id_column_name"),sequence_number_column_name:d.get(r,"[0].sequence_number_column_name"),operation_type_id_column_name:d.get(r,"[0].operation_type_id_column_name"),operation_type_desc_column_name:d.get(r,"[0].operation_type_desc_column_name"),append_only:d.get(r,"[0].append_only",!1),temporalTableTimeStartColumnName:L,temporalTableTimeEndColumnName:M,indexing:d.get(r,"[0].indexing",""),distribution:d.get(r,"[0].distribution",""),hashColumn:d.get(r,"[0].hashColumn",[]),partition:re.getTablePartitionKey(T),indexingOrderColumn:d.get(r,"[0].indexingOrderColumn",[]),clusteringColumn:d.get(r,"[0].compositeClusteringKey",[])},temporalTableTime:{startTime:L,endTime:M},memoryOptimizedIndexes:A?a(r,n.schemaData):[]})},hydrateViewColumn(n){return{dbName:d.get(n.containerData,"[0].databaseName",""),schemaName:n.dbName,alias:n.alias,name:n.name,tableName:n.entityName,isActivated:n.isActivated}},hydrateView({viewData:n,entityData:r,relatedSchemas:T,relatedContainers:C}){let A=d.get(r,"[0]",{}),L=d.get(r,"[0].ifNotExist");return{...n,selectStatement:A.selectStatement||"",viewAttrbute:A.viewAttrbute||"",materialized:A.materialized,withCheckOption:!!A.withCheckOption,ifNotExist:L,options:{distribution:d.get(r,"[0].distribution",""),hashColumn:d.get(r,"[0].hashColumn",[]),forAppend:d.get(r,"[0].forAppend")}}},commentIfDeactivated(n,r,T){return ee(n,r,T)},dropSchema(n){return E(f.dropSchema,{terminator:b,name:n})},dropTable(n){return E(f.dropTable,{name:n,terminator:b})},dropIndex(n,r){let T=e(n,r.schemaName);return E(f.dropIndex,{name:r.name,object:T,terminator:b})},dropColumn(n,r){let T=E(f.dropColumn,{name:r});return E(f.alterTable,{tableName:n,command:T,terminator:b})},addColumn(n,r){let T=E(f.addColumn,{script:r});return E(f.alterTable,{tableName:n,command:T,terminator:b})},renameColumn(n,r,T){return E(f.renameColumn,{terminator:b===";"?"":b,fullTableName:n,oldColumnName:r,newColumnName:T})},alterColumn(n,r){let T=m(r.type)?d.toUpper(r.type):e(r.type,r.schemaName),C=r.nullable?" NULL":" NOT NULL",A=E(f.alterColumn,{name:r.name,type:H(T,r),not_null:C});return E(f.alterTable,{tableName:n,command:A,terminator:b})},dropView(n){return E(f.dropView,{name:n,terminator:b})},alterView({name:n,keys:r,selectStatement:T,materialized:C,schemaData:A,ifNotExist:L},M){let B=L?";":b,F=p(r,A);if(C||(d.isEmpty(F.tables)||d.isEmpty(F.columns))&&!T)return"";let x=F.columns.map(U=>U.statement).join(`,
		`);if(M){let U=K(F.columns,k=>k.statement),Q=U.deactivatedItems.length?ee(U.deactivatedItems.join(`,
		`),{isActivated:!1},!0):"";x=U.activatedItems.join(`,
		`)+Q}let P=e(n,A.schemaName),V=d.trim(T)?d.trim(v(T))+`
`:E(f.viewSelectStatement,{tableName:F.tables.join(", "),keys:x,terminator:B});return E(f.alterView,{name:P,select_statement:V,terminator:B})}}},"provider");module.exports=It;
