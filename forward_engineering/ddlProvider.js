"use strict";var Fe=Object.defineProperty;var n=(p,c)=>Fe(p,"name",{value:c,configurable:!0});var H=(p,c)=>()=>(c||p((c={exports:{}}).exports,c),c.exports);var le=H((Ze,ce)=>{"use strict";ce.exports={number:"NUMERIC",string:"CHAR",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BIT",document:"NVARCHAR",array:"NVARCHAR",objectId:"VARCHAR(24)",jsonObject:"NVARCHAR",default:"CHAR"}});var ie=H((Je,me)=>{"use strict";me.exports={TINYINT:{capacity:1},SMALLINT:{capacity:2},INT:{capacity:4},BIGINT:{capacity:8},FLOAT:{capacity:8,mode:"floating"},REAL:{capacity:4,mode:"floating"},DECIMAL:{capacity:16,mode:"decimal"},NUMERIC:{capacity:12,mode:"decimal"},MONEY:{capacity:8,mode:"decimal"},SMALLMONEY:{capacity:4,mode:"decimal"},CHAR:{size:1},VARCHAR:{mode:"varying"},NCHAR:{size:1,encoding:"utf-8"},NVARCHAR:{encoding:"utf-8"},TEXT:{mode:"text"},NTEXT:{mode:"text",encoding:"utf-8"},DATE:{format:"YYYY-MM-DD"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss"},DATETIME2:{format:"YYYY-MM-DD hh:mm:ss.nnn"},DATETIMEOFFSET:{format:"YYYY-MM-DD hh:mm:ss.nnnZ"},SMALLDATETIME:{format:"YYYY-MM-DD hh:mm:ss"},TIME:{format:"hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},BINARY:{size:8e3,mode:"binary"},VARBINARY:{size:2147483649,mode:"binary"},IMAGE:{mode:"binary"},BIT:{mode:"boolean"},HIERARCHYID:{capacity:5,mode:"uuid"},UNIQUEIDENTIFIER:{mode:"uuid"},SQL_VARIANT:{mode:"variant"},XML:{mode:"xml"},GEOMETRY:{format:"euclidian",mode:"geospatial"},GEOGRAPHY:{format:"ellipsoidal",mode:"geospatial"},ROWVERSION:{mode:"version"},TABLE:{mode:"table"}}});var J=H((et,ue)=>{"use strict";ue.exports={createDatabase:"CREATE DATABASE [${name}]${terminator}\nUSE [${name}]${terminator}",createSchema:"CREATE SCHEMA [${name}]${terminator}",createTable:"CREATE${external} TABLE ${name} (\n	${column_definitions}${temporalTableTime}${keyConstraints}${checkConstraints}${foreignKeyConstraints}${memoryOptimizedIndexes}\n)${options}${terminator}\n",columnDefinition:"[${name}] ${type}${primary_key}${temporalTableTime}${sparse}${maskedWithFunction}${identity}${default}${collation}${not_null}${encryptedWith}",partition:"PARTITION ([${name}] RANGE ${range} FOR VALUES (${values}))",index:"CREATE${clustered} INDEX ${name}\n	ON ${table} ( ${keys} )${index_options}${terminator}\n",columnStoreIndex:"CREATE CLUSTERED COLUMNSTORE INDEX ${name}\n	ON ${table}${order}${index_options}${terminator}\n",fullTextIndex:"CREATE FULLTEXT INDEX ON ${table} (\n	${keys}\n)\nKEY INDEX ${indexName}\n${catalog}${options}${terminator}\n",spatialIndex:"CREATE SPATIAL INDEX ${name} ON ${table} (${column})${using}\n${options}${terminator}\n",checkConstraint:"CONSTRAINT [${name}] CHECK${notForReplication} (${expression})",createForeignKeyConstraint:"CONSTRAINT [${name}] FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})",createView:"CREATE${materialized} VIEW ${name}\n${view_attribute}AS ${select_statement}${check_option}${options}${terminator}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createUdtFromBaseType:"CREATE TYPE ${name} FROM ${base_type}${not_null}${terminator}\n",createKeyConstraint:"${constraintName}${keyType}${clustered}${columns}${options}${partition}",createDefaultConstraint:"ALTER TABLE ${tableName} ADD CONSTRAINT [${constraintName}] DEFAULT (${default}) FOR [${columnName}]${terminator}\n",ifNotExistSchema:"IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = N'${schemaName}')\nbegin\n	EXEC('${statement}')\nend${terminator}",ifNotExistDatabase:"IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = N'[${databaseName}]')\nbegin\n${statement}\nend${terminator}",ifNotExistTable:`IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'\${tableName}') AND type in (N'U'))
begin
\${statement}
end\${terminator}
`,ifNotExistView:`IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'\${viewName}') AND type in (N'V'))
begin
EXEC('
\${statement}')
end\${terminator}
`,dropSchema:"DROP SCHEMA [${name}]${terminator}",dropTable:"DROP TABLE ${name}${terminator}",dropIndex:"DROP INDEX [${name}] ON ${object}${terminator}",alterTableOptions:"ALTER TABLE ${tableName} ${options}${terminator}",alterTableAddConstraint:"ALTER TABLE ${tableName} ADD ${constraint}${terminator}",alterTable:"ALTER TABLE ${tableName} ${command}${terminator}",dropColumn:"DROP COLUMN [${name}]",addColumn:"ADD ${script}",alterColumn:"ALTER COLUMN [${name}] ${type}${collation}${not_null}",renameColumn:"EXEC sp_rename '${fullTableName}.${oldColumnName}', '${newColumnName}', 'COLUMN';${terminator}",dropView:"DROP VIEW IF EXISTS ${name}${terminator}",alterView:"ALTER VIEW ${name}\nAS ${select_statement}${terminator}"}});var Q=H((tt,pe)=>{"use strict";var de="-- ",xe=/(\n\/\*\n[\s\S]*?\n\s\*\/\n)|((\n\/\*\n[\s\S]*?\n\s\*\/)$)/gi,Pe=n((p,c,I)=>c?.hasOwnProperty("isActivated")&&!c.isActivated?I?"/* "+p+" */":p.includes(`
`)?`/*
`+p+` */
`:de+p:p,"commentIfDeactivated"),Ue=n((p="")=>p.startsWith(de),"queryIsDeactivated"),we=n(p=>p.replace(xe,""),"filterDeactivatedQuery");pe.exports={commentIfDeactivated:Pe,queryIsDeactivated:Ue,filterDeactivatedQuery:we}});var ye=H((nt,Te)=>{"use strict";var ke=n(({index:p,numberOfStatements:c,lastIndexOfActivatedStatement:I,delimiter:o})=>{let L=p===c-1,N=p===I;return L?"":N?" --"+o:o},"getDelimiter"),qe=n(({statements:p=[],delimiter:c=",",indent:I=`
`})=>{let o=p.findLastIndex(N=>!N.startsWith("--")),L=p.length;return p.map((N,_)=>{let k=ke({index:_,numberOfStatements:L,lastIndexOfActivatedStatement:o,delimiter:c});return N+k}).join(I)},"joinActivatedAndDeactivatedStatements");Te.exports={joinActivatedAndDeactivatedStatements:qe}});var Ne=H((st,Ee)=>{"use strict";var Ye=`
GO`,He="useGoStatement",Ve=n(p=>(p?.additionalOptions??[]).find(I=>I.id===He)?.value,"needToUseGoStatement"),Ge=n(p=>Ve(p)?Ye:";","getTerminator");Ee.exports={getTerminator:Ge}});var Ae=H((ot,Ie)=>{"use strict";Ie.exports=p=>{let c=p.require("lodash"),{assignTemplates:I}=p.require("@hackolade/ddl-fe-utils"),{tab:o}=p.require("@hackolade/ddl-fe-utils").general;return{wrapIfNotExistSchema:n(({templates:S,schemaStatement:g,schemaName:$,terminator:O})=>I(S.ifNotExistSchema,{statement:c.trim(o(g)),schemaName:$,terminator:O}),"wrapIfNotExistSchema"),wrapIfNotExistDatabase:n(({templates:S,databaseStatement:g,databaseName:$,terminator:O})=>I(S.ifNotExistDatabase,{statement:o(g),databaseName:$,terminator:O}),"wrapIfNotExistDatabase"),wrapIfNotExistTable:n(({templates:S,tableStatement:g,tableName:$,terminator:O})=>I(S.ifNotExistTable,{statement:o(g),tableName:$,terminator:O}),"wrapIfNotExistTable"),wrapIfNotExistView:n(({templates:S,viewStatement:g,viewName:$,terminator:O})=>I(S.ifNotExistView,{statement:o(g),viewName:$,terminator:O}),"wrapIfNotExistView")}}});var se=H((lt,fe)=>{"use strict";fe.exports=p=>{let c=p.require("lodash"),I=n((i,T)=>`${i}(${T})`,"addLength"),o=n(i=>`${i}(MAX)`,"addMaxLength"),L=n((i,T,K)=>c.isNumber(K)?`${i}(${T},${K})`:`${i}(${T})`,"addScalePrecision"),N=n((i,T)=>`${i}(${T})`,"addPrecision"),_=n((i,T,K)=>K?T?`${i}(${T} ${K})`:`${i}(${K})`:i,"addXmlProperties"),k=n(i=>["CHAR","NCHAR","VARCHAR","NVARCHAR","BINARY","VARBINARY"].includes(i),"canHaveLength"),S=n(i=>["VARCHAR","NVARCHAR","VARBINARY"].includes(i),"canHaveMax"),g=n(i=>["DECIMAL","NUMERIC","DATETIME2","DATETIMEOFFSET","TIME"].includes(i),"canHavePrecision"),$=n(i=>["DECIMAL","NUMERIC"].includes(i),"canHaveScale"),O=n((i,T)=>S(i)&&T.hasMaxLength?o(i):k(i)&&c.isNumber(T.length)?I(i,T.length):g(i)&&$(i)&&c.isNumber(T.precision)?L(i,T.precision,T.scale):g(i)&&c.isNumber(T.precision)?N(i,T.precision):i==="XML"?_(i,T.xmlConstraint,T.xmlSchemaCollection):i,"decorateType"),b=n(i=>["CHAR","VARCHAR","NCHAR","NVARCHAR","TEXT","NTEXT"].includes(c.toUpper(i)),"isString"),q=n(i=>c.trim(i).replace(/(\')+/g,"'$1"),"escapeQuotes");return{decorateType:O,decorateDefault:n((i,T)=>b(i)&&T!=="NULL"?`'${q(T)}'`:i==="XML"?`CAST(N'${T}' AS xml)`:T,"decorateDefault"),getIdentity:n(i=>!i.seed||!i.increment?"":` IDENTITY(${i.seed}, ${i.increment})`,"getIdentity"),getEncryptedWith:n(i=>` ENCRYPTED WITH (
		COLUMN_ENCRYPTION_KEY=`+i.key+`,
		ENCRYPTION_TYPE=`+i.type+`,
		ALGORITHM='`+i.algorithm+`'
	)`,"getEncryptedWith"),addClustered:n((i,T)=>!T.primaryKey&&!T.unique?"":T.clustered?i+" CLUSTERED":i+" NONCLUSTERED","addClustered"),canHaveIdentity:n(i=>["tinyint","smallint","int","bigint"].includes(i),"canHaveIdentity")}}});var ee=H((ut,Ce)=>{"use strict";var{commentIfDeactivated:ge}=Q(),Be=ie(),De=J();Ce.exports=p=>{let c=p.require("lodash"),I=p.require("@hackolade/ddl-fe-utils").general.hasType,{decorateDefault:o}=se()(p),{checkAllKeysDeactivated:L}=p.require("@hackolade/ddl-fe-utils").general,{assignTemplates:N}=p.require("@hackolade/ddl-fe-utils"),_="clustered columnstore index order",k="clustered index",S="hash",g=n(s=>["VARCHAR","CHAR","NCHAR","NVARCHAR"].includes(c.toUpper(s)),"isString"),$=n((s,m)=>m?`[${m}].[${s}]`:`[${s}]`,"getTableName"),O=n((s,m,y)=>c.isUndefined(s)||!c.isUndefined(m)?"":` DEFAULT ${o(y,s)}`,"getDefaultValue"),b=n(s=>s?s.alias?`[${s.name}] as [${s.alias}]`:`[${s.name}]`:"","getKeyWithAlias");return{filterColumnStoreProperties:n(s=>{if(s.type!=="columnstore")return s;let m=["allowRowLocks","allowPageLocks","padIndex","fillFactor","ignoreDuplicateKey"];return Object.keys(s).reduce((y,d)=>m.includes(d)?y:Object.assign({},y,{[d]:s[d]}),{})},"filterColumnStoreProperties"),getKeyWithAlias:b,getTableName:$,getTableOptions:n(s=>{if(!s)return"";let m=c.get(s,"partition",{}),y=[];if(s.indexing){let d=c.toUpper(s.indexing);s.indexing===_&&(d+="(",d+=s.indexingOrderColumn.map(({name:A})=>`[${A}]`).join(", "),d+=")"),s.indexing===k&&(d+="(",d+=s.clusteringColumn.map(({name:A})=>`[${A}]`).join(", "),d+=")"),y.push(d)}if(m.name){let d=c.toUpper(m.rangeForValues||"LEFT"),A=m.boundaryValue||"",te=N(De.partition,{name:m.name,range:d,values:A});y.push(ge(te,{isActivated:m.isActivated}))}if(s.distribution){let d=`DISTRIBUTION = ${c.toUpper(s.distribution)}`;s.distribution===S&&(d+="(",d+=s.hashColumn.map(({name:A})=>`[${A}]`).join(", "),d+=")"),y.push(d)}return s.forAppend&&y.push("FOR_APPEND"),c.isEmpty(y)?"":`WITH (
	${y.join(`,
	`)}
)`},"getTableOptions"),hasType:n(s=>I(Be,s),"hasType"),getViewData:n((s,m)=>Array.isArray(s)?s.reduce((y,d)=>{if(!d.tableName)return y.columns.push(b(d)),y;let A=$(d.tableName,d.schemaName);return d.dbName&&d.dbName!==m.databaseName&&(A=`[${d.dbName}].`+A),y.tables.includes(A)||y.tables.push(A),y.columns.push({statement:`${A}.${b(d)}`,isActivated:d.isActivated}),y},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),getDefaultConstraints:n(s=>Array.isArray(s)?s.filter(m=>c.get(m,"defaultConstraint.name")&&!c.isNil(c.get(m,"defaultConstraint.value"))).map(m=>({columnName:m.name,constraintName:m.defaultConstraint.name,value:o(m.type,m.defaultConstraint.value)})):[],"getDefaultConstraints"),foreignKeysToString:n(s=>{if(Array.isArray(s)){let m=s.filter(A=>c.get(A,"isActivated",!0)).map(A=>`[${A.name.trim()}]`),y=s.filter(A=>!c.get(A,"isActivated",!0)).map(A=>`[${A.name.trim()}]`),d=y.length?ge(y,{isActivated:!1},!0):"";return m.join(", ")+d}return s},"foreignKeysToString"),trimBraces:n(s=>/^\(([\s\S]+?)\)$/i.test(c.trim(s))?c.trim(s).replace(/^\(([\s\S]+?)\)$/i,"$1"):s,"trimBraces"),checkIndexActivated:n(s=>{if(s.isActivated===!1)return!1;let m=L(c.get(s,"keys",[])),y=L(c.get(s,"include",[])),d=!c.get(s,"column.isActivated",!0);return!m&&!y&&!d},"checkIndexActivated"),foreignActiveKeysToString:n(s=>s.map(m=>m.name.trim()).join(", "),"foreignActiveKeysToString"),getDefaultValue:O,getTempTableTime:n((s,m,y)=>s?` GENERATED ALWAYS AS ROW START${y?" HIDDEN":""}`:m?` GENERATED ALWAYS AS ROW END${y?" HIDDEN":""}`:"","getTempTableTime"),getCollation:n((s,m)=>!g(s)||c.isEmpty(m)?"":" COLLATE "+Object.entries(m).map(([y,d])=>d).join("_"),"getCollation"),setPersistenceSpecificName:n((s,m)=>s!=="temporary"||c.first(m)==="#"?m:`#${m}`,"setPersistenceSpecificName")}}});var Re=H((pt,Oe)=>{"use strict";var $e=J(),{commentIfDeactivated:ae}=Q();Oe.exports=p=>{let c=p.require("lodash"),{filterColumnStoreProperties:I,getTableName:o}=ee()(p),{assignTemplates:L}=p.require("@hackolade/ddl-fe-utils"),{divideIntoActivatedAndDeactivated:N,checkAllKeysDeactivated:_}=p.require("@hackolade/ddl-fe-utils").general,k=n(e=>{let l=[];return e.padIndex&&l.push("PAD_INDEX = ON"),e.fillFactor&&l.push("FILLFACTOR = "+e.fillFactor),e.ignoreDuplicateKey&&l.push("IGNORE_DUP_KEY = ON"),e.statisticsNoRecompute&&l.push("STATISTICS_NORECOMPUTE = ON"),e.statisticsIncremental&&l.push("STATISTICS_INCREMENTAL = ON"),e.allowRowLocks===!1&&l.push("ALLOW_ROW_LOCKS = OFF"),e.allowPageLocks===!1&&l.push("ALLOW_PAGE_LOCKS = OFF"),e.optimizeForSequentialKey&&l.push("OPTIMIZE_FOR_SEQUENTIAL_KEY = ON"),e.type==="columnstore"&&e.compressionDelay&&l.push("COMPRESSION_DELAY = "+e.compressionDelay),e.dataCompression&&e.dataCompression!=="NONE"&&l.push("DATA_COMPRESSION = "+e.dataCompression),l},"getRelationOptionsIndex"),S=n(e=>{let l=[];return e.dropExisting&&l.unshift("DROP_EXISTING = ON"),l},"getIndexOptions"),g=n(e=>e.length?`
	WITH (
		`+e.join(`,
		`)+`
	)`:"","createIndexOptions"),$=n((e,l,u)=>{let s=N(e,l),m=s.deactivatedItems.join(", "),y=m?ae(m,{isActivated:!1},!0):"",d=s.activatedItems.join(", ");return u?d+y:d+(m?", ":"")+m},"getIndexKeys"),O=n((e,l,u,s=!0)=>{if(c.isEmpty(u.keys)||!u.name)return"";let m=S(u),y=$(u.keys,A=>`[${A.name}]`+(c.toLower(A.type)==="descending"?" DESC":""),s),d=u.clustered?" CLUSTERED":" NONCLUSTERED";return L($e.index,{name:u.name,clustered:d,table:o(l,u.schemaName),keys:y,index_options:g(m),terminator:e})},"createIndex"),b=n((e,l,u,s=!0)=>{if(!u.name)return"";let m=S(u),y=$(u.orderKeys||[],d=>`[${d.name}]`,s);return L($e.columnStoreIndex,{name:u.name,table:o(l,u.schemaName),order:y?`
	ORDER (${y})`:"",index_options:g(m),terminator:e})},"createColumnStoreIndex"),q=n((e,l,u,s)=>u.type==="columnstore"?b(e,l,u,s):O(e,l,u,s),"createTableIndex"),G=n(e=>{let l="CLUSTERED COLUMNSTORE";return e.compressionDelay&&(l+=` WITH (COMPRESSION_DELAY = ${e.compressionDelay})`),e.fileGroupName&&(l+=` ON ${e.fileGroupName}`),l},"createMemoryOptimizedClusteredIndex"),B=n(e=>l=>{let u=`INDEX ${l.name}`;if(l.clustered)return{statement:u+" "+G(l),isActivated:!0};let s=_(l.keys);if(u+=" NONCLUSTERED",l.unique&&(u+=" UNIQUE"),l.hash){let m=N(l.keys,A=>`[${A.name}]`),y=m.activatedItems.join(", "),d=m.deactivatedItems.length?ae(m.deactivatedItems.join(", "),{isActivated:!e},!0):"";u+=` HASH (${y}${y.length&&d.length&&!d.startsWith("/*")?", ":""}${d})`,l.bucketCount&&(u+=` WITH (BUCKET_COUNT=${l.bucketCount})`)}else{let m=N(l.keys,A=>`[${A.name}]${c.toLower(A.type)==="descending"?" DESC":""}`),y=m.activatedItems.join(", "),d=m.deactivatedItems.length?ae(m.deactivatedItems.join(", "),{isActivated:!e},!0):"";u+=` (${y}${y.length&&d.length&&!d.startsWith("/*")?", ":""}${d})`,l.fileGroupName&&(u+=` ON ${l.fileGroupName}`)}return{statement:u,isActivated:!s}},"createMemoryOptimizedIndex"),M=n((e,l)=>{let u=n(s=>Array.isArray(s)?s:[],"toArray");return I({name:e.indxName,isActivated:e.isActivated,type:c.toLower(e.indxType),clustered:e.clusteredIndx,keys:u(e.indxKey),orderKeys:u(e.orderKey),dropExisting:e.DROP_EXISTING,schemaName:l.schemaName})},"hydrateIndex"),W=n(e=>l=>{let u=M(l,e);return{name:u.name,isActivated:u.isActivated,clustered:u.clustered,hash:l.indxHash,unique:u.unique,keys:u.keys,bucketCount:isNaN(l.indxBucketCount)?-1:l.indxBucketCount,fileGroupName:l.indxFileGroupName,compressionDelay:u.compressionDelay}},"hydrateMemoryOptimizedIndex"),a=n((e,l)=>{let u=M(e,l);return{type:"fulltext",isActivated:e.isActivated,keys:Array.isArray(e.indxFullTextKeysProperties)?u.keys.map((s,m)=>{let y=e.indxFullTextKeysProperties[m];return y?{...s,columnType:y.columnType,languageTerm:y.languageTerm,statisticalSemantics:y.statisticalSemantics}:s}):u.keys,keyIndex:e.indxFullTextKeyIndex,catalogName:e.indxFullTextCatalogName,fileGroup:e.indxFullTextFileGroup,changeTracking:e.indxFullTextChangeTracking==="OFF"&&e.indxFullTextNoPopulation?"OFF, NO POPULATION":e.indxFullTextChangeTracking,stopList:e.indxFullTextStopList==="Stoplist name"?e.indxFullTextStopListName:e.indxFullTextStopList,searchPropertyList:e.indxFullTextSearchPropertyList,schemaName:l.schemaName}},"hydrateFullTextIndex"),i=n((e,l)=>{let u=M(e,l);return{...c.pick(u,["name","type","padIndex","fillFactor","ignoreDuplicateKey","statisticsNoRecompute","allowRowLocks","allowPageLocks","dataCompression","isActivated"]),column:u.keys[0],using:e.indxUsing,boundingBox:!c.isEmpty(e.indxBoundingBox)&&["GEOMETRY_AUTO_GRID","GEOMETRY_GRID"].includes(e.indxUsing)?e.indxBoundingBox:{},grids:!c.isEmpty(e.indxGrids)&&["GEOMETRY_GRID","GEOGRAPHY_GRID"].includes(e.indxUsing)?e.indxGrids:[],cellsPerObject:e.CELLS_PER_OBJECT,sortInTempdb:e.SORT_IN_TEMPDB,dropExisting:e.DROP_EXISTING,maxdop:e.MAXDOP,schemaName:l.schemaName}},"hydrateSpatialIndex");return{getRelationOptionsIndex:k,createIndex:O,hydrateIndex:M,hydrateMemoryOptimizedIndex:W,createMemoryOptimizedIndex:B,hydrateTableIndex:n((e,l)=>e.indxType==="Spatial"?i(e,l):e.indxType==="FullText"?a(e,l):M(e,l),"hydrateTableIndex"),createTableIndex:q,getMemoryOptimizedIndexes:n((e,l)=>{let u=e.find(s=>c.has(s,"Indxs"));return u?u.Indxs.map(W(l)):[]},"getMemoryOptimizedIndexes")}}});var Se=H((yt,ve)=>{"use strict";var{commentIfDeactivated:be}=Q();ve.exports=p=>{let c=p.require("lodash"),{assignTemplates:I}=p.require("@hackolade/ddl-fe-utils"),{checkAllKeysDeactivated:o,divideIntoActivatedAndDeactivated:L}=p.require("@hackolade/ddl-fe-utils").general,{trimBraces:N}=ee()(p);return{createDefaultConstraint:n((g,$)=>(O,b)=>I(g.createDefaultConstraint,{tableName:b,constraintName:O.constraintName,columnName:O.columnName,default:N(O.value),terminator:$}),"createDefaultConstraint"),createKeyConstraint:n((g,$,O)=>b=>{let q=b.partition?` ON [${b.partition}]`:"",G=n(({name:i,order:T})=>`[${i}] ${T}`.trim(),"columnMapToString"),B=o(b.columns),M=L(b.columns,G),W=M.deactivatedItems.length?be(M.deactivatedItems.join(", "),{isActivated:!1},!0):"",a=!B&&O?" ("+M.activatedItems.join(", ")+W+")":" ("+b.columns.map(G).join(", ")+")";return{statement:I(g.createKeyConstraint,{constraintName:b.name?`CONSTRAINT [${b.name}] `:"",keyType:b.keyType,clustered:" NONCLUSTERED",columns:a,options:" NOT ENFORCED",partition:q,terminator:$}),isActivated:!B}},"createKeyConstraint"),generateConstraintsString:n((g,$)=>{let O=g.activatedItems.length?`,
	`+g.activatedItems.join(`,
	`):"",b=g.deactivatedItems.length?`
	`+be(g.deactivatedItems.join(`,
	`),{isActivated:!$},!0):"";return O+b},"generateConstraintsString")}}});var Le=H((Nt,he)=>{"use strict";he.exports=p=>{let c=p.require("lodash"),{clean:I}=p.require("@hackolade/ddl-fe-utils").general,o=n((a,i)=>Object.entries(a.properties).map(i),"mapProperties"),L=n(a=>a.compositeUniqueKey?!1:a.unique?!!c.isEmpty(a.uniqueKeyOptions):!1,"isInlineUnique"),N=n(a=>a.compositeUniqueKey||a.compositePrimaryKey?!1:a.primaryKey?!!c.isEmpty(a.primaryKeyOptions):!1,"isInlinePrimaryKey"),_=n(a=>a.compositeUniqueKey?!1:a.unique?!c.isEmpty(a.uniqueKeyOptions):!1,"isUnique"),k=n(a=>a.compositeUniqueKey||a.compositePrimaryKey?!1:a.primaryKey?!c.isEmpty(a.primaryKeyOptions):!1,"isPrimaryKey"),S=n(a=>c.toLower(a)==="asc"?"ASC":c.toLower(a)==="desc"?"DESC":"","getOrder"),g=n((a,i,T)=>I({keyType:"UNIQUE",name:a.constraintName,columns:[{name:i,order:S(a.order),isActivated:T}],partition:a.partitionName,clustered:a.clustered,indexOption:I({statisticsNoRecompute:a.staticticsNorecompute,statisticsIncremental:a.statisticsIncremental,ignoreDuplicateKey:a.ignoreDuplicate,fillFactor:a.fillFactor,allowRowLocks:!!a.allowRowLocks,allowPageLocks:!!a.allowPageLocks,optimizeForSequentialKey:a.isOptimizedForSequentialKey,padIndex:a.isPadded,dataCompression:a.dataCompression})}),"hydrateUniqueOptions"),$=n((a,i,T)=>I({keyType:"PRIMARY KEY",name:a.constraintName,columns:[{name:i,order:S(a.order),isActivated:T}],partition:a.partitionName,clustered:a.clustered,indexOption:I({statisticsNoRecompute:a.staticticsNorecompute,statisticsIncremental:a.statisticsIncremental,ignoreDuplicateKey:a.ignoreDuplicate,fillFactor:a.fillFactor,allowRowLocks:!!a.allowRowLocks,allowPageLocks:!!a.allowPageLocks,optimizeForSequentialKey:a.isOptimizedForSequentialKey,padIndex:a.isPadded,dataCompression:a.dataCompression})}),"hydratePrimaryKeyOptions"),O=n((a,i)=>Object.keys(i).find(T=>i[T].GUID===a),"findName"),b=n((a,i)=>c.get(Object.values(i).find(T=>T.GUID===a),"isActivated",!0),"checkIfActivated"),q=n((a,i)=>a.map(T=>({name:O(T.keyId,i.properties),order:T.type==="descending"?"DESC":"ASC",isActivated:b(T.keyId,i.properties)})),"getKeys"),G=n(a=>Array.isArray(a.primaryKey)?a.primaryKey.filter(i=>!c.isEmpty(i.compositePrimaryKey)).map(i=>({...$(i),columns:q(i.compositePrimaryKey,a)})):[],"getCompositePrimaryKeys"),B=n(a=>Array.isArray(a.uniqueKey)?a.uniqueKey.filter(i=>!c.isEmpty(i.compositeUniqueKey)).map(i=>({...g(i),columns:q(i.compositeUniqueKey,a)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:n(({jsonSchema:a})=>{if(!a.properties)return[];let i=c.flatten(o(a,([K,e])=>_(e)?e.uniqueKeyOptions.map(l=>g(l,K,e.isActivated)):[])).filter(Boolean),T=o(a,([K,e])=>{if(k(e))return $(e.primaryKeyOptions,K,e.isActivated)}).filter(Boolean);return[...G(a),...T,...B(a),...i]},"getTableKeyConstraints"),isInlineUnique:L,isInlinePrimaryKey:N,getTablePartitionKey:n(a=>{let i=q(a.partition||[],a);return{...c.get(i,"[0]",{}),boundaryValue:a.boundaryValue,rangeForValues:a.rangeForValues}},"getTablePartitionKey")}}});var We=le(),Xe=ie(),C=J(),{commentIfDeactivated:j}=Q(),{joinActivatedAndDeactivatedStatements:ze}=ye(),je=n((p,c,I)=>{let o=I.require("lodash"),{getTerminator:L}=Ne(),{assignTemplates:N}=I.require("@hackolade/ddl-fe-utils"),{divideIntoActivatedAndDeactivated:_,clean:k,tab:S}=I.require("@hackolade/ddl-fe-utils").general,{wrapIfNotExistSchema:g,wrapIfNotExistDatabase:$,wrapIfNotExistTable:O,wrapIfNotExistView:b}=Ae()(I),{decorateType:q,getIdentity:G,getEncryptedWith:B,decorateDefault:M,canHaveIdentity:W}=se()(I),{getMemoryOptimizedIndexes:a,createMemoryOptimizedIndex:i,hydrateTableIndex:T,createTableIndex:K}=Re()(I),{getTableName:e,getTableOptions:l,hasType:u,getDefaultConstraints:s,checkIndexActivated:m,getViewData:y,getCollation:d,setPersistenceSpecificName:A}=ee()(I),{createKeyConstraint:te,createDefaultConstraint:_e,generateConstraintsString:Ke}=Se()(I),Z=Le()(I),v=L(c);return{createSchema({schemaName:r,databaseName:t,ifNotExist:E}){let R=E?";":v,f=N(C.createSchema,{name:r,terminator:R});if(!t)return E?g({templates:C,schemaStatement:f,schemaName:r,terminator:v}):f;let h=$({templates:C,databaseName:t,terminator:v,databaseStatement:N(C.createDatabase,{name:t,terminator:R})});return E?h+`

`+g({templates:C,schemaStatement:f,schemaName:r,terminator:v}):h+`

`+f},createTable({name:r,columns:t,checkConstraints:E,keyConstraints:R,options:f,schemaData:h,defaultConstraints:F,memoryOptimizedIndexes:D,persistence:x,ifNotExist:P},U){let V=P?";":v,w=e(A(x,r),h.schemaName),X=_(R.map(te(C,V,U)),z=>z.statement),Y=Ke(X,U),re=ze({statements:t,indent:`
	`}),ne=N(C.createTable,{name:w,external:x==="external"?" EXTERNAL":"",column_definitions:re,checkConstraints:E.length?`,
	`+E.join(`,
	`):"",foreignKeyConstraints:"",options:l(f),keyConstraints:Y,memoryOptimizedIndexes:D.length?`,
	`+D.map(i(U)).map(z=>j(z.statement,z)).join(`,
	`):"",terminator:V}),Me=F.map(z=>_e(C,V)(z,w)).join(`
`),oe=[ne,Me].filter(Boolean).join(`

`);return P?O({tableStatement:oe,templates:C,tableName:w,terminator:v}):oe},convertColumnDefinition(r){let t=u(r.type)?o.toUpper(r.type):e(r.type,r.schemaName),E=r.nullable?"":" NOT NULL",R=r.primaryKey?" PRIMARY KEY NONCLUSTERED NOT ENFORCED":"",f=o.isUndefined(r.default)?"":" DEFAULT "+M(t,r.default),h=r.sparse?" SPARSE":"",F=r.maskedWithFunction?` MASKED WITH (FUNCTION='${r.maskedWithFunction}')`:"",D=r.identity&&{identity:G(r.identity)},x=o.isEmpty(r.encryption)?"":B(r.encryption[0]),P=r.unique?" UNIQUE NOT ENFORCED":"";return j(N(C.columnDefinition,{name:r.name,type:q(t,r),primary_key:R+P,not_null:E,default:f,collation:d(r.type,r.collation),sparse:h,maskedWithFunction:F,encryptedWith:x,terminator:v,...D}),r)},createIndex(r,t,E,R=!0){let f=m(t);return R?j(K(v,r,t,f&&R),{isActivated:f}):K(v,r,t,f&&R)},createCheckConstraint(r){return N(C.checkConstraint,{name:r.name,notForReplication:r.enforceForReplication?"":" NOT FOR REPLICATION",expression:o.trim(r.expression).replace(/^\(([\s\S]*)\)$/,"$1"),terminator:v})},createForeignKeyConstraint(){return""},createForeignKey(){return""},createView({name:r,keys:t,selectStatement:E,options:R,materialized:f,schemaData:h,ifNotExist:F},D,x){let P=F?";":v,U=y(t,h);if((o.isEmpty(U.tables)||o.isEmpty(U.columns))&&!E)return"";let V=U.columns.map(Y=>Y.statement).join(",n		");if(x){let Y=_(U.columns,ne=>ne.statement),re=Y.deactivatedItems.length?j(Y.deactivatedItems.join(`,
		`),{isActivated:!1},!0):"";V=Y.activatedItems.join(`,
		`)+re}let w=e(r,h.schemaName);if(!f){let Y=N(C.createView,{name:w,select_statement:o.trim(E)?o.trim(S(E))+`
`:N(C.viewSelectStatement,{tableName:U.tables.join(", "),keys:V,terminator:P}),terminator:P});return F?b({templates:C,viewStatement:Y,viewName:w,terminator:v}):Y}let X=N(C.createView,{name:w,materialized:" MATERIALIZED",options:l(R),select_statement:o.trim(E)?o.trim(S(E))+`
`:N(C.viewSelectStatement,{tableName:U.tables.join(", "),keys:V,terminator:P}),terminator:P});return F?b({templates:C,viewStatement:X,viewName:w,terminator:v}):X},createUdt(){return""},getDefaultType(r){return We[r]},getTypesDescriptors(){return Xe},hasType(r){return u(r)},hydrateColumn({columnDefinition:r,jsonSchema:t,schemaData:E,parentJsonSchema:R}){let f=[];Array.isArray(t.encryption)?f=t.encryption.map(({COLUMN_ENCRYPTION_KEY:P,ENCRYPTION_TYPE:U,ENCRYPTION_ALGORITHM:V})=>({key:P,type:U,algorithm:V})):o.isPlainObject(t.encryption)&&(f=[{key:t.encryption.COLUMN_ENCRYPTION_KEY,type:t.encryption.ENCRYPTION_TYPE,algorithm:t.encryption.ENCRYPTION_ALGORITHM}]);let h=t.GUID===o.get(R,"periodForSystemTime[0].startTime[0].keyId",""),F=t.GUID===o.get(R,"periodForSystemTime[0].endTime[0].keyId",""),D=o.get(R,"periodForSystemTime[0].startTime[0].type","")==="hidden",x=o.get(R,"periodForSystemTime[0].startTime[0].type","")==="hidden";return Object.assign({},r,{default:t.defaultConstraintName?"":r.default,defaultConstraint:{name:t.defaultConstraintName,value:r.default},primaryKey:Z.isInlinePrimaryKey(t),xmlConstraint:String(t.XMLconstraint||""),xmlSchemaCollection:String(t.xml_schema_collection||""),sparse:!!t.sparse,maskedWithFunction:String(t.maskedWithFunction||""),schemaName:E.schemaName,unique:Z.isInlineUnique(t),isTempTableStartTimeColumn:h,isTempTableEndTimeColumn:F,isHidden:h?D:x,encryption:f,hasMaxLength:r.hasMaxLength||t.type==="jsonObject",collation:t.collate?k({locale:t.locale,caseSensitivity:t.caseSensitivity,accentSensitivity:t.accentSensitivity,kanaSensitivity:t.kanaSensitivity,widthSensitivity:t.widthSensitivity,variationSelectorSensitivity:t.variationSelectorSensitivity,binarySort:t.binarySort,utf8:t.utf8}):{},...W(t.mode)&&{identity:{seed:Number(o.get(t,"identity.identitySeed",0)),increment:Number(o.get(t,"identity.identityIncrement",0))}}})},hydrateIndex(r,t,E){if(!o.get(t,"[0].memory_optimized",!1))return T(r,E)},hydrateCheckConstraint(r){return{name:r.chkConstrName,expression:r.constrExpression,existingData:r.constrCheck,enforceForUpserts:r.constrEnforceUpserts,enforceForReplication:r.constrEnforceReplication}},hydrateSchema(r){return{schemaName:r.name,databaseName:r.databaseName,ifNotExist:r.ifNotExist}},hydrateTable({tableData:r,entityData:t,jsonSchema:E,idToNameHashTable:R}){let f=o.get(t,"[0].memory_optimized",!1),h=R[o.get(E,"periodForSystemTime[0].startTime[0].keyId","")],F=R[o.get(E,"periodForSystemTime[0].endTime[0].keyId","")];return Object.assign({},r,{foreignKeyConstraints:r.foreignKeyConstraints||[],keyConstraints:Z.getTableKeyConstraints({jsonSchema:E}),defaultConstraints:s(r.columnDefinitions),ifNotExist:E.ifNotExist,persistence:o.get(t,"[0].persistence",""),options:{memory_optimized:f,durability:o.get(t,"[0].durability",""),systemVersioning:o.get(t,"[0].systemVersioning",!1),historyTable:o.get(t,"[0].historyTable",""),dataConsistencyCheck:o.get(t,"[0].dataConsistencyCheck",!1),temporal:o.get(t,"[0].temporal",!1),ledger:o.get(t,"[0].ledger",!1),ledger_view:o.get(t,"[0].ledger_view"),transaction_id_column_name:o.get(t,"[0].transaction_id_column_name"),sequence_number_column_name:o.get(t,"[0].sequence_number_column_name"),operation_type_id_column_name:o.get(t,"[0].operation_type_id_column_name"),operation_type_desc_column_name:o.get(t,"[0].operation_type_desc_column_name"),append_only:o.get(t,"[0].append_only",!1),temporalTableTimeStartColumnName:h,temporalTableTimeEndColumnName:F,indexing:o.get(t,"[0].indexing",""),distribution:o.get(t,"[0].distribution",""),hashColumn:o.get(t,"[0].hashColumn",[]),partition:Z.getTablePartitionKey(E),indexingOrderColumn:o.get(t,"[0].indexingOrderColumn",[]),clusteringColumn:o.get(t,"[0].compositeClusteringKey",[])},temporalTableTime:{startTime:h,endTime:F},memoryOptimizedIndexes:f?a(t,r.schemaData):[]})},hydrateViewColumn(r){return{dbName:o.get(r.containerData,"[0].databaseName",""),schemaName:r.dbName,alias:r.alias,name:r.name,tableName:r.entityName,isActivated:r.isActivated}},hydrateView({viewData:r,entityData:t,relatedSchemas:E,relatedContainers:R}){let f=o.get(t,"[0]",{}),h=o.get(t,"[0].ifNotExist");return{...r,selectStatement:f.selectStatement||"",viewAttrbute:f.viewAttrbute||"",materialized:f.materialized,withCheckOption:!!f.withCheckOption,ifNotExist:h,options:{distribution:o.get(t,"[0].distribution",""),hashColumn:o.get(t,"[0].hashColumn",[]),forAppend:o.get(t,"[0].forAppend")}}},commentIfDeactivated(r,t,E){return j(r,t,E)},dropSchema(r){return N(C.dropSchema,{terminator:v,name:r})},dropTable(r){return N(C.dropTable,{name:r,terminator:v})},dropIndex(r,t){let E=e(r,t.schemaName);return N(C.dropIndex,{name:t.name,object:E,terminator:v})},dropColumn(r,t){let E=N(C.dropColumn,{name:t});return N(C.alterTable,{tableName:r,command:E,terminator:v})},addColumn(r,t){let E=N(C.addColumn,{script:t});return N(C.alterTable,{tableName:r,command:E,terminator:v})},renameColumn(r,t,E){return N(C.renameColumn,{terminator:v===";"?"":v,fullTableName:r,oldColumnName:t,newColumnName:E})},alterColumn(r,t){let E=u(t.type)?o.toUpper(t.type):e(t.type,t.schemaName),R=t.nullable?" NULL":" NOT NULL",f=N(C.alterColumn,{name:t.name,type:q(E,t),not_null:R});return N(C.alterTable,{tableName:r,command:f,terminator:v})},dropView(r){return N(C.dropView,{name:r,terminator:v})},alterView({name:r,keys:t,selectStatement:E,materialized:R,schemaData:f,ifNotExist:h},F){let D=h?";":v,x=y(t,f);if(R||(o.isEmpty(x.tables)||o.isEmpty(x.columns))&&!E)return"";let P=x.columns.map(w=>w.statement).join(`,
		`);if(F){let w=_(x.columns,Y=>Y.statement),X=w.deactivatedItems.length?j(w.deactivatedItems.join(`,
		`),{isActivated:!1},!0):"";P=w.activatedItems.join(`,
		`)+X}let U=e(r,f.schemaName),V=o.trim(E)?o.trim(S(E))+`
`:N(C.viewSelectStatement,{tableName:x.tables.join(", "),keys:P,terminator:D});return N(C.alterView,{name:U,select_statement:V,terminator:D})}}},"provider");module.exports=je;
