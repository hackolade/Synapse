"use strict";var _e=Object.defineProperty;var i=(y,c)=>_e(y,"name",{value:c,configurable:!0});var V=(y,c)=>()=>(c||y((c={exports:{}}).exports,c),c.exports);var ce=V((De,le)=>{"use strict";le.exports={number:"NUMERIC",string:"CHAR",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BIT",document:"NVARCHAR",array:"NVARCHAR",objectId:"VARCHAR(24)",jsonObject:"NVARCHAR",default:"CHAR"}});var ie=V((We,me)=>{"use strict";me.exports={TINYINT:{capacity:1},SMALLINT:{capacity:2},INT:{capacity:4},BIGINT:{capacity:8},FLOAT:{capacity:8,mode:"floating"},REAL:{capacity:4,mode:"floating"},DECIMAL:{capacity:16,mode:"decimal"},NUMERIC:{capacity:12,mode:"decimal"},MONEY:{capacity:8,mode:"decimal"},SMALLMONEY:{capacity:4,mode:"decimal"},CHAR:{size:1},VARCHAR:{mode:"varying"},NCHAR:{size:1,encoding:"utf-8"},NVARCHAR:{encoding:"utf-8"},TEXT:{mode:"text"},NTEXT:{mode:"text",encoding:"utf-8"},DATE:{format:"YYYY-MM-DD"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss"},DATETIME2:{format:"YYYY-MM-DD hh:mm:ss.nnn"},DATETIMEOFFSET:{format:"YYYY-MM-DD hh:mm:ss.nnnZ"},SMALLDATETIME:{format:"YYYY-MM-DD hh:mm:ss"},TIME:{format:"hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},BINARY:{size:8e3,mode:"binary"},VARBINARY:{size:2147483649,mode:"binary"},IMAGE:{mode:"binary"},BIT:{mode:"boolean"},HIERARCHYID:{capacity:5,mode:"uuid"},UNIQUEIDENTIFIER:{mode:"uuid"},SQL_VARIANT:{mode:"variant"},XML:{mode:"xml"},GEOMETRY:{format:"euclidian",mode:"geospatial"},GEOGRAPHY:{format:"ellipsoidal",mode:"geospatial"},ROWVERSION:{mode:"version"},TABLE:{mode:"table"}}});var J=V((Xe,ue)=>{"use strict";ue.exports={createDatabase:"CREATE DATABASE [${name}]${terminator}\nUSE [${name}]${terminator}",createSchema:"CREATE SCHEMA [${name}]${terminator}",createTable:"CREATE${external} TABLE ${name} (\n	${column_definitions}${temporalTableTime}${keyConstraints}${checkConstraints}${foreignKeyConstraints}${memoryOptimizedIndexes}\n)${options}${terminator}\n",columnDefinition:"[${name}] ${type}${primary_key}${temporalTableTime}${sparse}${maskedWithFunction}${identity}${default}${collation}${not_null}${encryptedWith}",partition:"PARTITION ([${name}] RANGE ${range} FOR VALUES (${values}))",index:"CREATE${clustered} INDEX ${name}\n	ON ${table} ( ${keys} )${index_options}${terminator}\n",columnStoreIndex:"CREATE CLUSTERED COLUMNSTORE INDEX ${name}\n	ON ${table}${order}${index_options}${terminator}\n",fullTextIndex:"CREATE FULLTEXT INDEX ON ${table} (\n	${keys}\n)\nKEY INDEX ${indexName}\n${catalog}${options}${terminator}\n",spatialIndex:"CREATE SPATIAL INDEX ${name} ON ${table} (${column})${using}\n${options}${terminator}\n",checkConstraint:"CONSTRAINT [${name}] CHECK${notForReplication} (${expression})",createForeignKeyConstraint:"CONSTRAINT [${name}] FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})",createView:"CREATE${materialized} VIEW ${name}\n${view_attribute}AS ${select_statement}${check_option}${options}${terminator}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createUdtFromBaseType:"CREATE TYPE ${name} FROM ${base_type}${not_null}${terminator}\n",createKeyConstraint:"${constraintName}${keyType}${clustered}${columns}${options}${partition}",createDefaultConstraint:"ALTER TABLE ${tableName} ADD CONSTRAINT [${constraintName}] DEFAULT (${default}) FOR [${columnName}]${terminator}\n",ifNotExistSchema:"IF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = N'${schemaName}')\nbegin\n	EXEC('${statement}')\nend${terminator}",ifNotExistDatabase:"IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = N'[${databaseName}]')\nbegin\n${statement}\nend${terminator}",ifNotExistTable:`IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'\${tableName}') AND type in (N'U'))
begin
\${statement}
end\${terminator}
`,ifNotExistView:`IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'\${viewName}') AND type in (N'V'))
begin
EXEC('
\${statement}')
end\${terminator}
`,dropSchema:"DROP SCHEMA [${name}]${terminator}",dropTable:"DROP TABLE ${name}${terminator}",dropIndex:"DROP INDEX [${name}] ON ${object}${terminator}",alterTableOptions:"ALTER TABLE ${tableName} ${options}${terminator}",alterTableAddConstraint:"ALTER TABLE ${tableName} ADD ${constraint}${terminator}",alterTable:"ALTER TABLE ${tableName} ${command}${terminator}",dropColumn:"DROP COLUMN [${name}]",addColumn:"ADD ${script}",alterColumn:"ALTER COLUMN [${name}] ${type}${collation}${not_null}",renameColumn:"EXEC sp_rename '${fullTableName}.${oldColumnName}', '${newColumnName}', 'COLUMN';${terminator}",dropView:"DROP VIEW IF EXISTS ${name}${terminator}",alterView:"ALTER VIEW ${name}\nAS ${select_statement}${terminator}"}});var Q=V((ze,pe)=>{"use strict";var de="-- ",Ke=/(\n\/\*\n[\s\S]*?\n\s\*\/\n)|(\n\/\*\n[\s\S]*?\n\s\*\/)$/gi,Me=i((y,c,I)=>c?.hasOwnProperty("isActivated")&&!c.isActivated?I?"/* "+y+" */":y.includes(`
`)?`/*
`+y+` */
`:de+y:y,"commentIfDeactivated"),Fe=i((y="")=>y.startsWith(de),"queryIsDeactivated"),xe=i(y=>y.replace(Ke,""),"filterDeactivatedQuery");pe.exports={commentIfDeactivated:Me,queryIsDeactivated:Fe,filterDeactivatedQuery:xe}});var ye=V((Qe,Te)=>{"use strict";var Pe=`
GO`,Ue="useGoStatement",we=i(y=>(y?.additionalOptions??[]).find(I=>I.id===Ue)?.value,"needToUseGoStatement"),ke=i(y=>we(y)?Pe:";","getTerminator");Te.exports={getTerminator:ke}});var Ne=V((Je,Ee)=>{"use strict";Ee.exports=y=>{let c=y.require("lodash"),{assignTemplates:I}=y.require("@hackolade/ddl-fe-utils"),{tab:o}=y.require("@hackolade/ddl-fe-utils").general;return{wrapIfNotExistSchema:i(({templates:S,schemaStatement:f,schemaName:$,terminator:O})=>I(S.ifNotExistSchema,{statement:c.trim(o(f)),schemaName:$,terminator:O}),"wrapIfNotExistSchema"),wrapIfNotExistDatabase:i(({templates:S,databaseStatement:f,databaseName:$,terminator:O})=>I(S.ifNotExistDatabase,{statement:o(f),databaseName:$,terminator:O}),"wrapIfNotExistDatabase"),wrapIfNotExistTable:i(({templates:S,tableStatement:f,tableName:$,terminator:O})=>I(S.ifNotExistTable,{statement:o(f),tableName:$,terminator:O}),"wrapIfNotExistTable"),wrapIfNotExistView:i(({templates:S,viewStatement:f,viewName:$,terminator:O})=>I(S.ifNotExistView,{statement:o(f),viewName:$,terminator:O}),"wrapIfNotExistView")}}});var se=V((tt,Ie)=>{"use strict";Ie.exports=y=>{let c=y.require("lodash"),I=i((n,p)=>`${n}(${p})`,"addLength"),o=i(n=>`${n}(MAX)`,"addMaxLength"),_=i((n,p,L)=>c.isNumber(L)?`${n}(${p},${L})`:`${n}(${p})`,"addScalePrecision"),N=i((n,p)=>`${n}(${p})`,"addPrecision"),w=i((n,p,L)=>L?p?`${n}(${p} ${L})`:`${n}(${L})`:n,"addXmlProperties"),Y=i(n=>["CHAR","NCHAR","VARCHAR","NVARCHAR","BINARY","VARBINARY"].includes(n),"canHaveLength"),S=i(n=>["VARCHAR","NVARCHAR","VARBINARY"].includes(n),"canHaveMax"),f=i(n=>["DECIMAL","NUMERIC","DATETIME2","DATETIMEOFFSET","TIME"].includes(n),"canHavePrecision"),$=i(n=>["DECIMAL","NUMERIC"].includes(n),"canHaveScale"),O=i((n,p)=>S(n)&&p.hasMaxLength?o(n):Y(n)&&c.isNumber(p.length)?I(n,p.length):f(n)&&$(n)&&c.isNumber(p.precision)?_(n,p.precision,p.scale):f(n)&&c.isNumber(p.precision)?N(n,p.precision):n==="XML"?w(n,p.xmlConstraint,p.xmlSchemaCollection):n,"decorateType"),b=i(n=>["CHAR","VARCHAR","NCHAR","NVARCHAR","TEXT","NTEXT"].includes(c.toUpper(n)),"isString"),k=i(n=>c.trim(n).replace(/(\')+/g,"'$1"),"escapeQuotes");return{decorateType:O,decorateDefault:i((n,p)=>b(n)&&p!=="NULL"?`'${k(p)}'`:n==="XML"?`CAST(N'${p}' AS xml)`:p,"decorateDefault"),getIdentity:i(n=>!n.seed||!n.increment?"":` IDENTITY(${n.seed}, ${n.increment})`,"getIdentity"),getEncryptedWith:i(n=>` ENCRYPTED WITH (
		COLUMN_ENCRYPTION_KEY=`+n.key+`,
		ENCRYPTION_TYPE=`+n.type+`,
		ALGORITHM='`+n.algorithm+`'
	)`,"getEncryptedWith"),addClustered:i((n,p)=>!p.primaryKey&&!p.unique?"":p.clustered?n+" CLUSTERED":n+" NONCLUSTERED","addClustered"),canHaveIdentity:i(n=>["tinyint","smallint","int","bigint"].includes(n),"canHaveIdentity")}}});var ee=V((nt,Ae)=>{"use strict";var{commentIfDeactivated:ge}=Q(),qe=ie(),Ye=J();Ae.exports=y=>{let c=y.require("lodash"),I=y.require("@hackolade/ddl-fe-utils").general.hasType,{decorateDefault:o}=se()(y),{checkAllKeysDeactivated:_}=y.require("@hackolade/ddl-fe-utils").general,{assignTemplates:N}=y.require("@hackolade/ddl-fe-utils"),w="clustered columnstore index order",Y="clustered index",S="hash",f=i(s=>["VARCHAR","CHAR","NCHAR","NVARCHAR"].includes(c.toUpper(s)),"isString"),$=i((s,m)=>m?`[${m}].[${s}]`:`[${s}]`,"getTableName"),O=i((s,m,T)=>c.isUndefined(s)||!c.isUndefined(m)?"":` DEFAULT ${o(T,s)}`,"getDefaultValue"),b=i(s=>s?s.alias?`[${s.name}] as [${s.alias}]`:`[${s.name}]`:"","getKeyWithAlias");return{filterColumnStoreProperties:i(s=>{if(s.type!=="columnstore")return s;let m=["allowRowLocks","allowPageLocks","padIndex","fillFactor","ignoreDuplicateKey"];return Object.keys(s).reduce((T,d)=>m.includes(d)?T:Object.assign({},T,{[d]:s[d]}),{})},"filterColumnStoreProperties"),getKeyWithAlias:b,getTableName:$,getTableOptions:i(s=>{if(!s)return"";let m=c.get(s,"partition",{}),T=[];if(s.indexing){let d=c.toUpper(s.indexing);s.indexing===w&&(d+="(",d+=s.indexingOrderColumn.map(({name:g})=>`[${g}]`).join(", "),d+=")"),s.indexing===Y&&(d+="(",d+=s.clusteringColumn.map(({name:g})=>`[${g}]`).join(", "),d+=")"),T.push(d)}if(m.name){let d=c.toUpper(m.rangeForValues||"LEFT"),g=m.boundaryValue||"",te=N(Ye.partition,{name:m.name,range:d,values:g});T.push(ge(te,{isActivated:m.isActivated}))}if(s.distribution){let d=`DISTRIBUTION = ${c.toUpper(s.distribution)}`;s.distribution===S&&(d+="(",d+=s.hashColumn.map(({name:g})=>`[${g}]`).join(", "),d+=")"),T.push(d)}return s.forAppend&&T.push("FOR_APPEND"),c.isEmpty(T)?"":`WITH (
	${T.join(`,
	`)}
)`},"getTableOptions"),hasType:i(s=>I(qe,s),"hasType"),getViewData:i((s,m)=>Array.isArray(s)?s.reduce((T,d)=>{if(!d.tableName)return T.columns.push(b(d)),T;let g=$(d.tableName,d.schemaName);return d.dbName&&d.dbName!==m.databaseName&&(g=`[${d.dbName}].`+g),T.tables.includes(g)||T.tables.push(g),T.columns.push({statement:`${g}.${b(d)}`,isActivated:d.isActivated}),T},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),getDefaultConstraints:i(s=>Array.isArray(s)?s.filter(m=>c.get(m,"defaultConstraint.name")&&!c.isNil(c.get(m,"defaultConstraint.value"))).map(m=>({columnName:m.name,constraintName:m.defaultConstraint.name,value:o(m.type,m.defaultConstraint.value)})):[],"getDefaultConstraints"),foreignKeysToString:i(s=>{if(Array.isArray(s)){let m=s.filter(g=>c.get(g,"isActivated",!0)).map(g=>`[${g.name.trim()}]`),T=s.filter(g=>!c.get(g,"isActivated",!0)).map(g=>`[${g.name.trim()}]`),d=T.length?ge(T,{isActivated:!1},!0):"";return m.join(", ")+d}return s},"foreignKeysToString"),trimBraces:i(s=>/^\(([\s\S]+?)\)$/i.test(c.trim(s))?c.trim(s).replace(/^\(([\s\S]+?)\)$/i,"$1"):s,"trimBraces"),checkIndexActivated:i(s=>{if(s.isActivated===!1)return!1;let m=_(c.get(s,"keys",[])),T=_(c.get(s,"include",[])),d=!c.get(s,"column.isActivated",!0);return!m&&!T&&!d},"checkIndexActivated"),foreignActiveKeysToString:i(s=>s.map(m=>m.name.trim()).join(", "),"foreignActiveKeysToString"),getDefaultValue:O,getTempTableTime:i((s,m,T)=>s?` GENERATED ALWAYS AS ROW START${T?" HIDDEN":""}`:m?` GENERATED ALWAYS AS ROW END${T?" HIDDEN":""}`:"","getTempTableTime"),getCollation:i((s,m)=>!f(s)||c.isEmpty(m)?"":" COLLATE "+Object.entries(m).map(([T,d])=>d).join("_"),"getCollation"),setPersistenceSpecificName:i((s,m)=>s!=="temporary"||c.first(m)==="#"?m:`#${m}`,"setPersistenceSpecificName")}}});var $e=V((st,Ce)=>{"use strict";var fe=J(),{commentIfDeactivated:ae}=Q();Ce.exports=y=>{let c=y.require("lodash"),{filterColumnStoreProperties:I,getTableName:o}=ee()(y),{assignTemplates:_}=y.require("@hackolade/ddl-fe-utils"),{divideIntoActivatedAndDeactivated:N,checkAllKeysDeactivated:w}=y.require("@hackolade/ddl-fe-utils").general,Y=i(e=>{let l=[];return e.padIndex&&l.push("PAD_INDEX = ON"),e.fillFactor&&l.push("FILLFACTOR = "+e.fillFactor),e.ignoreDuplicateKey&&l.push("IGNORE_DUP_KEY = ON"),e.statisticsNoRecompute&&l.push("STATISTICS_NORECOMPUTE = ON"),e.statisticsIncremental&&l.push("STATISTICS_INCREMENTAL = ON"),e.allowRowLocks===!1&&l.push("ALLOW_ROW_LOCKS = OFF"),e.allowPageLocks===!1&&l.push("ALLOW_PAGE_LOCKS = OFF"),e.optimizeForSequentialKey&&l.push("OPTIMIZE_FOR_SEQUENTIAL_KEY = ON"),e.type==="columnstore"&&e.compressionDelay&&l.push("COMPRESSION_DELAY = "+e.compressionDelay),e.dataCompression&&e.dataCompression!=="NONE"&&l.push("DATA_COMPRESSION = "+e.dataCompression),l},"getRelationOptionsIndex"),S=i(e=>{let l=[];return e.dropExisting&&l.unshift("DROP_EXISTING = ON"),l},"getIndexOptions"),f=i(e=>e.length?`
	WITH (
		`+e.join(`,
		`)+`
	)`:"","createIndexOptions"),$=i((e,l,u)=>{let s=N(e,l),m=s.deactivatedItems.join(", "),T=m?ae(m,{isActivated:!1},!0):"",d=s.activatedItems.join(", ");return u?d+T:d+(m?", ":"")+m},"getIndexKeys"),O=i((e,l,u,s=!0)=>{if(c.isEmpty(u.keys)||!u.name)return"";let m=S(u),T=$(u.keys,g=>`[${g.name}]`+(c.toLower(g.type)==="descending"?" DESC":""),s),d=u.clustered?" CLUSTERED":" NONCLUSTERED";return _(fe.index,{name:u.name,clustered:d,table:o(l,u.schemaName),keys:T,index_options:f(m),terminator:e})},"createIndex"),b=i((e,l,u,s=!0)=>{if(!u.name)return"";let m=S(u),T=$(u.orderKeys||[],d=>`[${d.name}]`,s);return _(fe.columnStoreIndex,{name:u.name,table:o(l,u.schemaName),order:T?`
	ORDER (${T})`:"",index_options:f(m),terminator:e})},"createColumnStoreIndex"),k=i((e,l,u,s)=>u.type==="columnstore"?b(e,l,u,s):O(e,l,u,s),"createTableIndex"),G=i(e=>{let l="CLUSTERED COLUMNSTORE";return e.compressionDelay&&(l+=` WITH (COMPRESSION_DELAY = ${e.compressionDelay})`),e.fileGroupName&&(l+=` ON ${e.fileGroupName}`),l},"createMemoryOptimizedClusteredIndex"),B=i(e=>l=>{let u=`INDEX ${l.name}`;if(l.clustered)return{statement:u+" "+G(l),isActivated:!0};let s=w(l.keys);if(u+=" NONCLUSTERED",l.unique&&(u+=" UNIQUE"),l.hash){let m=N(l.keys,g=>`[${g.name}]`),T=m.activatedItems.join(", "),d=m.deactivatedItems.length?ae(m.deactivatedItems.join(", "),{isActivated:!e},!0):"";u+=` HASH (${T}${T.length&&d.length&&!d.startsWith("/*")?", ":""}${d})`,l.bucketCount&&(u+=` WITH (BUCKET_COUNT=${l.bucketCount})`)}else{let m=N(l.keys,g=>`[${g.name}]${c.toLower(g.type)==="descending"?" DESC":""}`),T=m.activatedItems.join(", "),d=m.deactivatedItems.length?ae(m.deactivatedItems.join(", "),{isActivated:!e},!0):"";u+=` (${T}${T.length&&d.length&&!d.startsWith("/*")?", ":""}${d})`,l.fileGroupName&&(u+=` ON ${l.fileGroupName}`)}return{statement:u,isActivated:!s}},"createMemoryOptimizedIndex"),K=i((e,l)=>{let u=i(s=>Array.isArray(s)?s:[],"toArray");return I({name:e.indxName,isActivated:e.isActivated,type:c.toLower(e.indxType),clustered:e.clusteredIndx,keys:u(e.indxKey),orderKeys:u(e.orderKey),dropExisting:e.DROP_EXISTING,schemaName:l.schemaName})},"hydrateIndex"),W=i(e=>l=>{let u=K(l,e);return{name:u.name,isActivated:u.isActivated,clustered:u.clustered,hash:l.indxHash,unique:u.unique,keys:u.keys,bucketCount:isNaN(l.indxBucketCount)?-1:l.indxBucketCount,fileGroupName:l.indxFileGroupName,compressionDelay:u.compressionDelay}},"hydrateMemoryOptimizedIndex"),a=i((e,l)=>{let u=K(e,l);return{type:"fulltext",isActivated:e.isActivated,keys:Array.isArray(e.indxFullTextKeysProperties)?u.keys.map((s,m)=>{let T=e.indxFullTextKeysProperties[m];return T?{...s,columnType:T.columnType,languageTerm:T.languageTerm,statisticalSemantics:T.statisticalSemantics}:s}):u.keys,keyIndex:e.indxFullTextKeyIndex,catalogName:e.indxFullTextCatalogName,fileGroup:e.indxFullTextFileGroup,changeTracking:e.indxFullTextChangeTracking==="OFF"&&e.indxFullTextNoPopulation?"OFF, NO POPULATION":e.indxFullTextChangeTracking,stopList:e.indxFullTextStopList==="Stoplist name"?e.indxFullTextStopListName:e.indxFullTextStopList,searchPropertyList:e.indxFullTextSearchPropertyList,schemaName:l.schemaName}},"hydrateFullTextIndex"),n=i((e,l)=>{let u=K(e,l);return{...c.pick(u,["name","type","padIndex","fillFactor","ignoreDuplicateKey","statisticsNoRecompute","allowRowLocks","allowPageLocks","dataCompression","isActivated"]),column:u.keys[0],using:e.indxUsing,boundingBox:!c.isEmpty(e.indxBoundingBox)&&["GEOMETRY_AUTO_GRID","GEOMETRY_GRID"].includes(e.indxUsing)?e.indxBoundingBox:{},grids:!c.isEmpty(e.indxGrids)&&["GEOMETRY_GRID","GEOGRAPHY_GRID"].includes(e.indxUsing)?e.indxGrids:[],cellsPerObject:e.CELLS_PER_OBJECT,sortInTempdb:e.SORT_IN_TEMPDB,dropExisting:e.DROP_EXISTING,maxdop:e.MAXDOP,schemaName:l.schemaName}},"hydrateSpatialIndex");return{getRelationOptionsIndex:Y,createIndex:O,hydrateIndex:K,hydrateMemoryOptimizedIndex:W,createMemoryOptimizedIndex:B,hydrateTableIndex:i((e,l)=>e.indxType==="Spatial"?n(e,l):e.indxType==="FullText"?a(e,l):K(e,l),"hydrateTableIndex"),createTableIndex:k,getMemoryOptimizedIndexes:i((e,l)=>{let u=e.find(s=>c.has(s,"Indxs"));return u?u.Indxs.map(W(l)):[]},"getMemoryOptimizedIndexes")}}});var be=V((ot,Re)=>{"use strict";var{commentIfDeactivated:Oe}=Q();Re.exports=y=>{let c=y.require("lodash"),{assignTemplates:I}=y.require("@hackolade/ddl-fe-utils"),{checkAllKeysDeactivated:o,divideIntoActivatedAndDeactivated:_}=y.require("@hackolade/ddl-fe-utils").general,{trimBraces:N}=ee()(y);return{createDefaultConstraint:i((f,$)=>(O,b)=>I(f.createDefaultConstraint,{tableName:b,constraintName:O.constraintName,columnName:O.columnName,default:N(O.value),terminator:$}),"createDefaultConstraint"),createKeyConstraint:i((f,$,O)=>b=>{let k=b.partition?` ON [${b.partition}]`:"",G=i(({name:n,order:p})=>`[${n}] ${p}`.trim(),"columnMapToString"),B=o(b.columns),K=_(b.columns,G),W=K.deactivatedItems.length?Oe(K.deactivatedItems.join(", "),{isActivated:!1},!0):"",a=!B&&O?" ("+K.activatedItems.join(", ")+W+")":" ("+b.columns.map(G).join(", ")+")";return{statement:I(f.createKeyConstraint,{constraintName:b.name?`CONSTRAINT [${b.name}] `:"",keyType:b.keyType,clustered:" NONCLUSTERED",columns:a,options:" NOT ENFORCED",partition:k,terminator:$}),isActivated:!B}},"createKeyConstraint"),generateConstraintsString:i((f,$)=>{let O=f.activatedItems.length?`,
	`+f.activatedItems.join(`,
	`):"",b=f.deactivatedItems.length?`
	`+Oe(f.deactivatedItems.join(`,
	`),{isActivated:!$},!0):"";return O+b},"generateConstraintsString")}}});var Se=V((ct,ve)=>{"use strict";ve.exports=y=>{let c=y.require("lodash"),{clean:I}=y.require("@hackolade/ddl-fe-utils").general,o=i((a,n)=>Object.entries(a.properties).map(n),"mapProperties"),_=i(a=>a.compositeUniqueKey?!1:a.unique?!!c.isEmpty(a.uniqueKeyOptions):!1,"isInlineUnique"),N=i(a=>a.compositeUniqueKey||a.compositePrimaryKey?!1:a.primaryKey?!!c.isEmpty(a.primaryKeyOptions):!1,"isInlinePrimaryKey"),w=i(a=>a.compositeUniqueKey?!1:a.unique?!c.isEmpty(a.uniqueKeyOptions):!1,"isUnique"),Y=i(a=>a.compositeUniqueKey||a.compositePrimaryKey?!1:a.primaryKey?!c.isEmpty(a.primaryKeyOptions):!1,"isPrimaryKey"),S=i(a=>c.toLower(a)==="asc"?"ASC":c.toLower(a)==="desc"?"DESC":"","getOrder"),f=i((a,n,p)=>I({keyType:"UNIQUE",name:a.constraintName,columns:[{name:n,order:S(a.order),isActivated:p}],partition:a.partitionName,clustered:a.clustered,indexOption:I({statisticsNoRecompute:a.staticticsNorecompute,statisticsIncremental:a.statisticsIncremental,ignoreDuplicateKey:a.ignoreDuplicate,fillFactor:a.fillFactor,allowRowLocks:!!a.allowRowLocks,allowPageLocks:!!a.allowPageLocks,optimizeForSequentialKey:a.isOptimizedForSequentialKey,padIndex:a.isPadded,dataCompression:a.dataCompression})}),"hydrateUniqueOptions"),$=i((a,n,p)=>I({keyType:"PRIMARY KEY",name:a.constraintName,columns:[{name:n,order:S(a.order),isActivated:p}],partition:a.partitionName,clustered:a.clustered,indexOption:I({statisticsNoRecompute:a.staticticsNorecompute,statisticsIncremental:a.statisticsIncremental,ignoreDuplicateKey:a.ignoreDuplicate,fillFactor:a.fillFactor,allowRowLocks:!!a.allowRowLocks,allowPageLocks:!!a.allowPageLocks,optimizeForSequentialKey:a.isOptimizedForSequentialKey,padIndex:a.isPadded,dataCompression:a.dataCompression})}),"hydratePrimaryKeyOptions"),O=i((a,n)=>Object.keys(n).find(p=>n[p].GUID===a),"findName"),b=i((a,n)=>c.get(Object.values(n).find(p=>p.GUID===a),"isActivated",!0),"checkIfActivated"),k=i((a,n)=>a.map(p=>({name:O(p.keyId,n.properties),order:p.type==="descending"?"DESC":"ASC",isActivated:b(p.keyId,n.properties)})),"getKeys"),G=i(a=>Array.isArray(a.primaryKey)?a.primaryKey.filter(n=>!c.isEmpty(n.compositePrimaryKey)).map(n=>({...$(n),columns:k(n.compositePrimaryKey,a)})):[],"getCompositePrimaryKeys"),B=i(a=>Array.isArray(a.uniqueKey)?a.uniqueKey.filter(n=>!c.isEmpty(n.compositeUniqueKey)).map(n=>({...f(n),columns:k(n.compositeUniqueKey,a)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i(({jsonSchema:a})=>{if(!a.properties)return[];let n=c.flatten(o(a,([L,e])=>w(e)?e.uniqueKeyOptions.map(l=>f(l,L,e.isActivated)):[])).filter(Boolean),p=o(a,([L,e])=>{if(Y(e))return $(e.primaryKeyOptions,L,e.isActivated)}).filter(Boolean);return[...G(a),...p,...B(a),...n]},"getTableKeyConstraints"),isInlineUnique:_,isInlinePrimaryKey:N,getTablePartitionKey:i(a=>{let n=k(a.partition||[],a);return{...c.get(n,"[0]",{}),boundaryValue:a.boundaryValue,rangeForValues:a.rangeForValues}},"getTablePartitionKey")}}});var He=ce(),Ve=ie(),C=J(),{commentIfDeactivated:j}=Q(),Ge=i((y,c,I)=>{let o=I.require("lodash"),{getTerminator:_}=ye(),{assignTemplates:N}=I.require("@hackolade/ddl-fe-utils"),{divideIntoActivatedAndDeactivated:w,clean:Y,tab:S}=I.require("@hackolade/ddl-fe-utils").general,{wrapIfNotExistSchema:f,wrapIfNotExistDatabase:$,wrapIfNotExistTable:O,wrapIfNotExistView:b}=Ne()(I),{decorateType:k,getIdentity:G,getEncryptedWith:B,decorateDefault:K,canHaveIdentity:W}=se()(I),{getMemoryOptimizedIndexes:a,createMemoryOptimizedIndex:n,hydrateTableIndex:p,createTableIndex:L}=$e()(I),{getTableName:e,getTableOptions:l,hasType:u,getDefaultConstraints:s,checkIndexActivated:m,getViewData:T,getCollation:d,setPersistenceSpecificName:g}=ee()(I),{createKeyConstraint:te,createDefaultConstraint:he,generateConstraintsString:Le}=be()(I),Z=Se()(I),v=_(c);return{createSchema({schemaName:r,databaseName:t,ifNotExist:E}){let R=E?";":v,A=N(C.createSchema,{name:r,terminator:R});if(!t)return E?f({templates:C,schemaStatement:A,schemaName:r,terminator:v}):A;let h=$({templates:C,databaseName:t,terminator:v,databaseStatement:N(C.createDatabase,{name:t,terminator:R})});return E?h+`

`+f({templates:C,schemaStatement:A,schemaName:r,terminator:v}):h+`

`+A},createTable({name:r,columns:t,checkConstraints:E,keyConstraints:R,options:A,schemaData:h,defaultConstraints:M,memoryOptimizedIndexes:D,persistence:F,ifNotExist:x},P){let H=x?";":v,U=e(g(F,r),h.schemaName),X=w(R.map(te(C,H,P)),z=>z.statement),q=Le(X,P),re=N(C.createTable,{name:U,external:F==="external"?" EXTERNAL":"",column_definitions:t.join(`,
	`),checkConstraints:E.length?`,
	`+E.join(`,
	`):"",foreignKeyConstraints:"",options:l(A),keyConstraints:q,memoryOptimizedIndexes:D.length?`,
	`+D.map(n(P)).map(z=>j(z.statement,z)).join(`,
	`):"",terminator:H}),ne=M.map(z=>he(C,H)(z,U)).join(`
`),oe=[re,ne].filter(Boolean).join(`

`);return x?O({tableStatement:oe,templates:C,tableName:U,terminator:v}):oe},convertColumnDefinition(r){let t=u(r.type)?o.toUpper(r.type):e(r.type,r.schemaName),E=r.nullable?"":" NOT NULL",R=r.primaryKey?" PRIMARY KEY NONCLUSTERED NOT ENFORCED":"",A=o.isUndefined(r.default)?"":" DEFAULT "+K(t,r.default),h=r.sparse?" SPARSE":"",M=r.maskedWithFunction?` MASKED WITH (FUNCTION='${r.maskedWithFunction}')`:"",D=r.identity&&{identity:G(r.identity)},F=o.isEmpty(r.encryption)?"":B(r.encryption[0]),x=r.unique?" UNIQUE NOT ENFORCED":"";return j(N(C.columnDefinition,{name:r.name,type:k(t,r),primary_key:R+x,not_null:E,default:A,collation:d(r.type,r.collation),sparse:h,maskedWithFunction:M,encryptedWith:F,terminator:v,...D}),r)},createIndex(r,t,E,R=!0){let A=m(t);return R?j(L(v,r,t,A&&R),{isActivated:A}):L(v,r,t,A&&R)},createCheckConstraint(r){return N(C.checkConstraint,{name:r.name,notForReplication:r.enforceForReplication?"":" NOT FOR REPLICATION",expression:o.trim(r.expression).replace(/^\(([\s\S]*)\)$/,"$1"),terminator:v})},createForeignKeyConstraint(){return""},createForeignKey(){return""},createView({name:r,keys:t,selectStatement:E,options:R,materialized:A,schemaData:h,ifNotExist:M},D,F){let x=M?";":v,P=T(t,h);if((o.isEmpty(P.tables)||o.isEmpty(P.columns))&&!E)return"";let H=P.columns.map(q=>q.statement).join(",n		");if(F){let q=w(P.columns,ne=>ne.statement),re=q.deactivatedItems.length?j(q.deactivatedItems.join(`,
		`),{isActivated:!1},!0):"";H=q.activatedItems.join(`,
		`)+re}let U=e(r,h.schemaName);if(!A){let q=N(C.createView,{name:U,select_statement:o.trim(E)?o.trim(S(E))+`
`:N(C.viewSelectStatement,{tableName:P.tables.join(", "),keys:H,terminator:x}),terminator:x});return M?b({templates:C,viewStatement:q,viewName:U,terminator:v}):q}let X=N(C.createView,{name:U,materialized:" MATERIALIZED",options:l(R),select_statement:o.trim(E)?o.trim(S(E))+`
`:N(C.viewSelectStatement,{tableName:P.tables.join(", "),keys:H,terminator:x}),terminator:x});return M?b({templates:C,viewStatement:X,viewName:U,terminator:v}):X},createUdt(){return""},getDefaultType(r){return He[r]},getTypesDescriptors(){return Ve},hasType(r){return u(r)},hydrateColumn({columnDefinition:r,jsonSchema:t,schemaData:E,parentJsonSchema:R}){let A=[];Array.isArray(t.encryption)?A=t.encryption.map(({COLUMN_ENCRYPTION_KEY:x,ENCRYPTION_TYPE:P,ENCRYPTION_ALGORITHM:H})=>({key:x,type:P,algorithm:H})):o.isPlainObject(t.encryption)&&(A=[{key:t.encryption.COLUMN_ENCRYPTION_KEY,type:t.encryption.ENCRYPTION_TYPE,algorithm:t.encryption.ENCRYPTION_ALGORITHM}]);let h=t.GUID===o.get(R,"periodForSystemTime[0].startTime[0].keyId",""),M=t.GUID===o.get(R,"periodForSystemTime[0].endTime[0].keyId",""),D=o.get(R,"periodForSystemTime[0].startTime[0].type","")==="hidden",F=o.get(R,"periodForSystemTime[0].startTime[0].type","")==="hidden";return Object.assign({},r,{default:t.defaultConstraintName?"":r.default,defaultConstraint:{name:t.defaultConstraintName,value:r.default},primaryKey:Z.isInlinePrimaryKey(t),xmlConstraint:String(t.XMLconstraint||""),xmlSchemaCollection:String(t.xml_schema_collection||""),sparse:!!t.sparse,maskedWithFunction:String(t.maskedWithFunction||""),schemaName:E.schemaName,unique:Z.isInlineUnique(t),isTempTableStartTimeColumn:h,isTempTableEndTimeColumn:M,isHidden:h?D:F,encryption:A,hasMaxLength:r.hasMaxLength||t.type==="jsonObject",collation:t.collate?Y({locale:t.locale,caseSensitivity:t.caseSensitivity,accentSensitivity:t.accentSensitivity,kanaSensitivity:t.kanaSensitivity,widthSensitivity:t.widthSensitivity,variationSelectorSensitivity:t.variationSelectorSensitivity,binarySort:t.binarySort,utf8:t.utf8}):{},...W(t.mode)&&{identity:{seed:Number(o.get(t,"identity.identitySeed",0)),increment:Number(o.get(t,"identity.identityIncrement",0))}}})},hydrateIndex(r,t,E){if(!o.get(t,"[0].memory_optimized",!1))return p(r,E)},hydrateCheckConstraint(r){return{name:r.chkConstrName,expression:r.constrExpression,existingData:r.constrCheck,enforceForUpserts:r.constrEnforceUpserts,enforceForReplication:r.constrEnforceReplication}},hydrateSchema(r){return{schemaName:r.name,databaseName:r.databaseName,ifNotExist:r.ifNotExist}},hydrateTable({tableData:r,entityData:t,jsonSchema:E,idToNameHashTable:R}){let A=o.get(t,"[0].memory_optimized",!1),h=R[o.get(E,"periodForSystemTime[0].startTime[0].keyId","")],M=R[o.get(E,"periodForSystemTime[0].endTime[0].keyId","")];return Object.assign({},r,{foreignKeyConstraints:r.foreignKeyConstraints||[],keyConstraints:Z.getTableKeyConstraints({jsonSchema:E}),defaultConstraints:s(r.columnDefinitions),ifNotExist:E.ifNotExist,persistence:o.get(t,"[0].persistence",""),options:{memory_optimized:A,durability:o.get(t,"[0].durability",""),systemVersioning:o.get(t,"[0].systemVersioning",!1),historyTable:o.get(t,"[0].historyTable",""),dataConsistencyCheck:o.get(t,"[0].dataConsistencyCheck",!1),temporal:o.get(t,"[0].temporal",!1),ledger:o.get(t,"[0].ledger",!1),ledger_view:o.get(t,"[0].ledger_view"),transaction_id_column_name:o.get(t,"[0].transaction_id_column_name"),sequence_number_column_name:o.get(t,"[0].sequence_number_column_name"),operation_type_id_column_name:o.get(t,"[0].operation_type_id_column_name"),operation_type_desc_column_name:o.get(t,"[0].operation_type_desc_column_name"),append_only:o.get(t,"[0].append_only",!1),temporalTableTimeStartColumnName:h,temporalTableTimeEndColumnName:M,indexing:o.get(t,"[0].indexing",""),distribution:o.get(t,"[0].distribution",""),hashColumn:o.get(t,"[0].hashColumn",[]),partition:Z.getTablePartitionKey(E),indexingOrderColumn:o.get(t,"[0].indexingOrderColumn",[]),clusteringColumn:o.get(t,"[0].compositeClusteringKey",[])},temporalTableTime:{startTime:h,endTime:M},memoryOptimizedIndexes:A?a(t,r.schemaData):[]})},hydrateViewColumn(r){return{dbName:o.get(r.containerData,"[0].databaseName",""),schemaName:r.dbName,alias:r.alias,name:r.name,tableName:r.entityName,isActivated:r.isActivated}},hydrateView({viewData:r,entityData:t,relatedSchemas:E,relatedContainers:R}){let A=o.get(t,"[0]",{}),h=o.get(t,"[0].ifNotExist");return{...r,selectStatement:A.selectStatement||"",viewAttrbute:A.viewAttrbute||"",materialized:A.materialized,withCheckOption:!!A.withCheckOption,ifNotExist:h,options:{distribution:o.get(t,"[0].distribution",""),hashColumn:o.get(t,"[0].hashColumn",[]),forAppend:o.get(t,"[0].forAppend")}}},commentIfDeactivated(r,t,E){return j(r,t,E)},dropSchema(r){return N(C.dropSchema,{terminator:v,name:r})},dropTable(r){return N(C.dropTable,{name:r,terminator:v})},dropIndex(r,t){let E=e(r,t.schemaName);return N(C.dropIndex,{name:t.name,object:E,terminator:v})},dropColumn(r,t){let E=N(C.dropColumn,{name:t});return N(C.alterTable,{tableName:r,command:E,terminator:v})},addColumn(r,t){let E=N(C.addColumn,{script:t});return N(C.alterTable,{tableName:r,command:E,terminator:v})},renameColumn(r,t,E){return N(C.renameColumn,{terminator:v===";"?"":v,fullTableName:r,oldColumnName:t,newColumnName:E})},alterColumn(r,t){let E=u(t.type)?o.toUpper(t.type):e(t.type,t.schemaName),R=t.nullable?" NULL":" NOT NULL",A=N(C.alterColumn,{name:t.name,type:k(E,t),not_null:R});return N(C.alterTable,{tableName:r,command:A,terminator:v})},dropView(r){return N(C.dropView,{name:r,terminator:v})},alterView({name:r,keys:t,selectStatement:E,materialized:R,schemaData:A,ifNotExist:h},M){let D=h?";":v,F=T(t,A);if(R||(o.isEmpty(F.tables)||o.isEmpty(F.columns))&&!E)return"";let x=F.columns.map(U=>U.statement).join(`,
		`);if(M){let U=w(F.columns,q=>q.statement),X=U.deactivatedItems.length?j(U.deactivatedItems.join(`,
		`),{isActivated:!1},!0):"";x=U.activatedItems.join(`,
		`)+X}let P=e(r,A.schemaName),H=o.trim(E)?o.trim(S(E))+`
`:N(C.viewSelectStatement,{tableName:F.tables.join(", "),keys:x,terminator:D});return N(C.alterView,{name:P,select_statement:H,terminator:D})}}},"provider");module.exports=Ge;
